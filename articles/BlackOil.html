<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Material Balance - Black Oil Reservoirs â€¢ Rmbal</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Material Balance - Black Oil Reservoirs">
<meta property="og:description" content="Rmbal">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rmbal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BlackOil.html">Material Balance - Black Oil Reservoirs</a>
    </li>
    <li>
      <a href="../articles/DryWetGas.html">Material Balance - Dry and Wet Gas Reservoirs</a>
    </li>
    <li>
      <a href="../articles/GasCondensate.html">Material Balance - Gas Condensate Reservoirs</a>
    </li>
    <li>
      <a href="../articles/Introduction.html">Rmbal Package</a>
    </li>
    <li>
      <a href="../articles/VolatileOil.html">Material Balance - Volatile Oil Reservoirs</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Material Balance - Black Oil Reservoirs</h1>
            
      
      
      <div class="hidden name"><code>BlackOil.Rmd</code></div>

    </div>

    
    
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a><code>Examples</code>
</h1>
<div id="example-1-undersaturated-black-oil-reservoir-ahmed2004" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-undersaturated-black-oil-reservoir-ahmed2004" class="anchor"></a><code>Example 1: Undersaturated Black Oil Reservoir</code> <font size="2"> <span class="citation">(Ahmed &amp; McKinney, 2004)</span> </font>
</h2>
<div id="part-i-history-match" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">minpack.lm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'magrittr'</span>
<span class="co">#&gt; The following objects are masked from 'package:pracma':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     and, mod, or</span>

 <span class="no">pvt_table_oil</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rpvt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rpvt/man/pvt_oil.html">pvt_oil</a></span>(<span class="st">"Field"</span>, <span class="st">"Field"</span>, <span class="st">"black_oil"</span>,
                                              <span class="st">"Standing"</span>, <span class="st">"Beggs_Robinson"</span>, <span class="fl">200</span>,
                                              <span class="fl">7150</span>, <span class="fl">43</span>, <span class="fl">0.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>), <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>,
                                              <span class="kw">warning</span> <span class="kw">=</span> <span class="st">"no"</span>))

 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">pvt_table_oil</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"t"</span>, <span class="st">"p"</span>, <span class="st">"Rs"</span>, <span class="st">"Bo"</span>, <span class="st">"dens_o"</span>, <span class="st">"co"</span>, <span class="st">"muo"</span>, <span class="st">"Z"</span>,
                              <span class="st">"Bg"</span>, <span class="st">"dens_g"</span>, <span class="st">"cg"</span>, <span class="st">"mug"</span>, <span class="st">"m_p"</span>)

 <span class="no">pvt_table_water</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rpvt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rpvt/man/pvt_water.html">pvt_water</a></span>(<span class="st">"Field"</span>, <span class="st">"Field"</span>, <span class="st">"water"</span>,
                                                  <span class="st">"Spivey"</span>, <span class="st">"Spivey"</span>, <span class="fl">200</span>, <span class="fl">7150</span>,
                                                  <span class="fl">0</span>, <span class="st">"no"</span>, <span class="st">"no"</span>))

 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">pvt_table_water</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"t"</span>, <span class="st">"p"</span>, <span class="st">"Rsw"</span>, <span class="st">"Bw"</span>, <span class="st">"dens_w"</span>, <span class="st">"cw"</span>, <span class="st">"muw"</span>)

 <span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">pvt_table_oil</span>, <span class="no">pvt_table_water</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"p"</span>, <span class="st">"t"</span>))

 <span class="no">pvt_table</span>$<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pvt_table</span>))           <span class="co"># zero for black oil</span>

 <span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="no">pvt_table</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">p</span>, <span class="no">Bo</span>, <span class="no">Rs</span>, <span class="no">Rv</span>, <span class="no">Bg</span>, <span class="no">Bw</span>, <span class="no">muo</span>, <span class="no">mug</span>, <span class="no">muw</span>)

 <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7150</span>,<span class="fl">6600</span>,<span class="fl">5800</span>,<span class="fl">4950</span>,<span class="fl">4500</span>)

 <span class="no">We</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">8.072</span>, <span class="fl">22.549</span>, <span class="fl">36.369</span>, <span class="fl">43.473</span>) * <span class="fl">1e6</span>

 <span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">pvt_table</span>$<span class="no">Rs</span>[<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pvt_table</span>)], <span class="fl">4</span>))

 <span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                            <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"N"</span>, <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                                            <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.43</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>,
                                            <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>, <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>, <span class="kw">We</span> <span class="kw">=</span> <span class="no">We</span>,
                                            <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>, <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">4e-6</span>,
                                            <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0</span>)

 <span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fl">1</span>:<span class="fl">5</span>, <span class="st">"year"</span>)

 <span class="co"># a number of plots will be automatically generated for quality check</span>

 <span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-2-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-2-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 6.35e+08</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.2</span>
<span class="co">#&gt;  $ swi        : num 0.43</span>
<span class="co">#&gt;  $ pb         : num 4500</span>
<span class="co">#&gt;  $ p          : num [1:5] 7150 6600 5800 4950 4500</span>
<span class="co">#&gt;  $ cf         : num [1:5] 4e-06 4e-06 4e-06 4e-06 4e-06</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 716 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:716] 0 10 20 30 40 50 60 70 80 90 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:716] 1.07 1.07 1.07 1.07 1.07 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:716] 4.87 6.37 7.93 9.54 11.2 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:716] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:716] 0.2257 0.1342 0.0954 0.074 0.0604 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:716] 1.04 1.04 1.04 1.04 1.04 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:716] 1 0.993 0.985 0.978 0.97 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:716] 0.0127 0.0127 0.0127 0.0127 0.0127 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:716] 0.302 0.302 0.302 0.302 0.302 ...</span>
<span class="co">#&gt;  $ prod       :'data.frame': 5 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:5] 0 8072000 22549000 36369000 43473000</span>
<span class="co">#&gt;   ..$ Rp: num [1:5] 1450 1450 1450 1450 1450</span>
<span class="co">#&gt;   ..$ Wp: num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;  $ inj        :'data.frame': 5 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Wi: num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;  $ We         : num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;  $ aquifer    :List of 3</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ We         : num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "NoA" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:5] 1 1 1 1 1</span>
<span class="co">#&gt;  $ sorw       : num 0</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ p_est      : num [1:5] 7150 6627 5723 4924 4545</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "volumetric_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;   P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1     7150   0.00000000 0.000000e+00  0.000000000       0.0000     0.00000000</span>
<span class="co">#&gt; 2     6600   0.01458555 2.021415e-05  0.001602328       0.0022     0.02332055</span>
<span class="co">#&gt; 3     5800   0.03775399 5.761629e-05  0.003966834       0.0054     0.05923794</span>
<span class="co">#&gt; 4     4950   0.06642728 1.135771e-04  0.006524389       0.0088     0.10151519</span>
<span class="co">#&gt; 5     4500   0.08438586 1.539536e-04  0.007897814       0.0106     0.12670085</span>
<span class="co">#&gt;   Egwf (bbl/SCF) Et (bbl)  F (bbl) We Igd       Isd Inwd      Ifwd Iawd Itot</span>
<span class="co">#&gt; 1   0.000000e+00        0        0  0  NA        NA   NA        NA   NA   NA</span>
<span class="co">#&gt; 2   2.301691e-05 14807612 14077898  0   0 0.6254379    0 0.3745621    0    1</span>
<span class="co">#&gt; 3   6.450975e-05 37613713 39848802  0   0 0.6373278    0 0.3626722    0    1</span>
<span class="co">#&gt; 4   1.248356e-04 64458071 65314454  0   0 0.6543580    0 0.3456420    0    1</span>
<span class="co">#&gt; 5   1.675310e-04 80449954 78853117  0   0 0.6660244    0 0.3339756    0    1</span>
<span class="co">#&gt;       RF_oil     RF_gas  SOo SGo  SWo  SOT           SGT  SWT qo (STB/day)</span>
<span class="co">#&gt; 1 0.00000000 0.00000000 0.57   0 0.43 0.57 -5.551115e-17 0.43         0.00</span>
<span class="co">#&gt; 2 0.01337156 0.01337156 0.57   0 0.43 0.57 -5.551115e-17 0.43     22115.07</span>
<span class="co">#&gt; 3 0.03352061 0.03352061 0.57   0 0.43 0.57 -5.551115e-17 0.43     39663.01</span>
<span class="co">#&gt; 4 0.05652663 0.05652663 0.57   0 0.43 0.57 -5.551115e-17 0.43     37863.01</span>
<span class="co">#&gt; 5 0.06985223 0.06985223 0.57   0 0.43 0.57 -5.551115e-17 0.43     19463.01</span>
<span class="co">#&gt;   qg (SCF/day) qw (STB/day) fg fw GOR (SCF/STB) krg/kro</span>
<span class="co">#&gt; 1            0            0  0  0      1449.989       0</span>
<span class="co">#&gt; 2     32066603            0  0  0      1449.989       0</span>
<span class="co">#&gt; 3     57510928            0  0  0      1449.989       0</span>
<span class="co">#&gt; 4     54900948            0  0  0      1449.989       0</span>
<span class="co">#&gt; 5     28221153            0  0  0      1449.989       0</span></pre></body></html></div>
</div>
<div id="part-iii-reservoir-forecast" class="section level3">
<h3 class="hasAnchor">
<a href="#part-iii-reservoir-forecast" class="anchor"></a><code>Part III: Reservoir Forecast</code>
</h3>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="co"># gas saturation above the bubble point is zero, however the mbal_forecast_param_oil()</span>
<span class="co"># requires a table of relative permeabilities as an input for the gas-oil system. </span>
<span class="co"># Therefore, an arbitrary table is generated using the 'Rrelperm' package.</span>
<span class="co"># The generated table does not impact the predictions above the bubble point.</span>


<span class="no">rel_perm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="fl">0.43</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="fl">0.15</span>, <span class="kw">SORG</span> <span class="kw">=</span> <span class="fl">0.15</span>,
                                            <span class="kw">SGCON</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="fl">1</span>,
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">NG</span> <span class="kw">=</span> <span class="fl">1.5</span>, <span class="kw">NOG</span> <span class="kw">=</span> <span class="fl">1.0</span>, <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>))

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">rel_perm</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sg"</span>, <span class="st">"Sl"</span>, <span class="st">"Krg"</span>, <span class="st">"Krog"</span>)

<span class="no">forecast_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_param_oil.html">mbal_forecast_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                        <span class="kw">N</span> <span class="kw">=</span> <span class="fl">6.35e8</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.43</span>,
                                        <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>,
                                        <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">4e-6</span>, <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">rel_perm</span> <span class="kw">=</span> <span class="no">rel_perm</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">forecast_lst</span>)
<span class="co">#&gt; List of 14</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 6.35e+08</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.1</span>
<span class="co">#&gt;  $ swi        : num 0.43</span>
<span class="co">#&gt;  $ pb         : num 4500</span>
<span class="co">#&gt;  $ p          : num [1:5] 7150 6600 5800 4950 4500</span>
<span class="co">#&gt;  $ cf         : num [1:5] 4e-06 4e-06 4e-06 4e-06 4e-06</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 716 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:716] 0 10 20 30 40 50 60 70 80 90 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:716] 1.07 1.07 1.07 1.07 1.07 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:716] 4.87 6.37 7.93 9.54 11.2 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:716] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:716] 0.2257 0.1342 0.0954 0.074 0.0604 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:716] 1.04 1.04 1.04 1.04 1.04 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:716] 1 0.993 0.985 0.978 0.97 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:716] 0.0127 0.0127 0.0127 0.0127 0.0127 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:716] 0.302 0.302 0.302 0.302 0.302 ...</span>
<span class="co">#&gt;  $ inj        :'data.frame': 5 obs. of  1 variable:</span>
<span class="co">#&gt;   ..$ Gi: num [1:5] 0 0 0 0 0</span>
<span class="co">#&gt;  $ wf         : num [1:5] 1 1 1 1 1</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ rel_perm   :'data.frame': 101 obs. of  4 variables:</span>
<span class="co">#&gt;   ..$ Sg  : num [1:101] 0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 ...</span>
<span class="co">#&gt;   ..$ Sl  : num [1:101] 1 0.99 0.98 0.97 0.96 0.95 0.94 0.93 0.92 0.91 ...</span>
<span class="co">#&gt;   ..$ Krg : num [1:101] 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Krog: num [1:101] 1 1 1 1 1 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "volumetric_forecast_oil" "forecast_oil"</span>

<span class="no">forecast_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_oil.html">mbal_forecast_oil</a></span>(<span class="no">forecast_lst</span>, <span class="no">time_lst</span>)

<span class="no">forecast_results</span>
<span class="co">#&gt;   P (psia)  SOo SGo  SWo  SOT           SGT  SWT GOR (SCF/STB)     RF_oil</span>
<span class="co">#&gt; 1     7150 0.57   0 0.43 0.57 -5.551115e-17 0.43      1449.989 0.00000000</span>
<span class="co">#&gt; 2     6600 0.57   0 0.43 0.57 -5.551115e-17 0.43      1449.989 0.01337156</span>
<span class="co">#&gt; 3     5800 0.57   0 0.43 0.57 -5.551115e-17 0.43      1449.989 0.03352061</span>
<span class="co">#&gt; 4     4950 0.57   0 0.43 0.57 -5.551115e-17 0.43      1449.989 0.05652663</span>
<span class="co">#&gt; 5     4500 0.57   0 0.43 0.57 -5.551115e-17 0.43      1449.989 0.06985223</span>
<span class="co">#&gt;       RF_gas Liq_volume Igd       Isd Inwd      Ifwd Iawd Itot</span>
<span class="co">#&gt; 1 0.00000000          1  NA        NA   NA        NA   NA   NA</span>
<span class="co">#&gt; 2 0.01337156          1   0 0.6254379    0 0.3745621    0    1</span>
<span class="co">#&gt; 3 0.03352061          1   0 0.6373278    0 0.3626722    0    1</span>
<span class="co">#&gt; 4 0.05652663          1   0 0.6543580    0 0.3456420    0    1</span>
<span class="co">#&gt; 5 0.06985223          1   0 0.6660244    0 0.3339756    0    1</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Isd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-4-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-2-undersaturated-black-oil-reservoir-ahmed2004" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-undersaturated-black-oil-reservoir-ahmed2004" class="anchor"></a><code>Example 2: Undersaturated Black Oil Reservoir</code> <font size="2"> <span class="citation">(Ahmed &amp; McKinney, 2004)</span> </font>
</h2>
<div id="part-i-history-match-1" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match-1" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

 <span class="no">pvt_table_oil</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rpvt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rpvt/man/pvt_oil.html">pvt_oil</a></span>(<span class="st">"Field"</span>, <span class="st">"Field"</span>, <span class="st">"black_oil"</span>,
                                              <span class="st">"Standing"</span>, <span class="st">"Beggs_Robinson"</span>, <span class="fl">200</span>,
                                              <span class="fl">7150</span>, <span class="fl">43</span>, <span class="fl">0.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>), <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>,
                                              <span class="kw">warning</span> <span class="kw">=</span> <span class="st">"no"</span>))

 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">pvt_table_oil</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"t"</span>, <span class="st">"p"</span>, <span class="st">"Rs"</span>, <span class="st">"Bo"</span>, <span class="st">"dens_o"</span>, <span class="st">"co"</span>, <span class="st">"muo"</span>, <span class="st">"Z"</span>,
                              <span class="st">"Bg"</span>, <span class="st">"dens_g"</span>, <span class="st">"cg"</span>, <span class="st">"mug"</span>, <span class="st">"m_p"</span>)

 <span class="no">pvt_table_water</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rpvt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rpvt/man/pvt_water.html">pvt_water</a></span>(<span class="st">"Field"</span>, <span class="st">"Field"</span>, <span class="st">"water"</span>,
                                                  <span class="st">"Spivey"</span>, <span class="st">"Spivey"</span>, <span class="fl">200</span>, <span class="fl">7150</span>,
                                                  <span class="fl">3e-6</span>, <span class="st">"no"</span>, <span class="st">"no"</span>))

 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">pvt_table_water</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"t"</span>, <span class="st">"p"</span>, <span class="st">"Rsw"</span>, <span class="st">"Bw"</span>, <span class="st">"dens_w"</span>, <span class="st">"cw"</span>, <span class="st">"muw"</span>)

 <span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">pvt_table_oil</span>, <span class="no">pvt_table_water</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"p"</span>, <span class="st">"t"</span>))

 <span class="no">pvt_table</span>$<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fl">0.0</span>          <span class="co"># zero for black oil</span>

 <span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="no">pvt_table</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">p</span>, <span class="no">Bo</span>, <span class="no">Rs</span>, <span class="no">Rv</span>, <span class="no">Bg</span>, <span class="no">Bw</span>, <span class="no">muo</span>, <span class="no">mug</span>, <span class="no">muw</span>)

 <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7150</span>, <span class="fl">6600</span>, <span class="fl">5800</span>, <span class="fl">4950</span>, <span class="fl">4500</span>, <span class="fl">4350</span>, <span class="fl">4060</span>, <span class="fl">3840</span>, <span class="fl">3600</span>, <span class="fl">3480</span>, <span class="fl">3260</span>, <span class="fl">3100</span>, <span class="fl">2940</span>, <span class="fl">2800</span>)

 <span class="no">We</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">8.072</span>, <span class="fl">22.549</span>, <span class="fl">36.369</span>, <span class="fl">43.473</span>, <span class="fl">49.182</span>, <span class="fl">58.383</span>, <span class="fl">64.812</span>, <span class="fl">69.562</span>, <span class="fl">74.572</span>,
         <span class="fl">78.4</span>, <span class="fl">81.275</span>, <span class="fl">83.879</span>, <span class="fl">86.401</span>) * <span class="fl">1e6</span>

 <span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">pvt_table</span>$<span class="no">Rs</span>[<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pvt_table</span>)], <span class="fl">4</span>), <span class="fl">1576</span>, <span class="fl">1788</span>, <span class="fl">1992</span>, <span class="fl">2158</span>, <span class="fl">2383</span>, <span class="fl">2596</span>, <span class="fl">2785</span>, <span class="fl">2953</span>, <span class="fl">3103</span>)

 <span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

 <span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                            <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"N"</span>, <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                                            <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.43</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>,
                                            <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>, <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>, <span class="kw">We</span> <span class="kw">=</span> <span class="no">We</span>,
                                            <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>, <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">4e-6</span>,
                                            <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0</span>)

 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">mbal_optim_oil_lst</span>)
<span class="co">#&gt; List of 17</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : NULL</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.2</span>
<span class="co">#&gt;  $ swi        : num 0.43</span>
<span class="co">#&gt;  $ pb         : num 4500</span>
<span class="co">#&gt;  $ p          : num [1:14] 7150 6600 5800 4950 4500 4350 4060 3840 3600 3480 ...</span>
<span class="co">#&gt;  $ cf         : num [1:14] 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 ...</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 716 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:716] 0 10 20 30 40 50 60 70 80 90 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:716] 1.07 1.07 1.07 1.07 1.07 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:716] 4.87 6.37 7.93 9.54 11.2 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:716] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:716] 0.2257 0.1342 0.0954 0.074 0.0604 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:716] 1.04 1.04 1.04 1.04 1.04 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:716] 1 0.993 0.985 0.978 0.97 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:716] 0.0127 0.0127 0.0127 0.0127 0.0127 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:716] 0.302 0.302 0.302 0.302 0.302 ...</span>
<span class="co">#&gt;  $ prod       :'data.frame': 14 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:14] 0 8072000 22549000 36369000 43473000 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:14] 1450 1450 1450 1450 1450 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ inj        :'data.frame': 14 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Wi: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ We         : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ aquifer    :List of 3</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ We         : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "NoA" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:14] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ sorw       : num 0</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "volumetric_optim_oil" "optimization_oil"</span>


 <span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fl">1</span>:<span class="fl">14</span>, <span class="st">"year"</span>)

 <span class="co"># a number of plots will be automatically generated for quality check</span>

 <span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-5-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-5-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 7.56e+08</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.2</span>
<span class="co">#&gt;  $ swi        : num 0.43</span>
<span class="co">#&gt;  $ pb         : num 4500</span>
<span class="co">#&gt;  $ p          : num [1:14] 7150 6600 5800 4950 4500 4350 4060 3840 3600 3480 ...</span>
<span class="co">#&gt;  $ cf         : num [1:14] 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 ...</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 716 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:716] 0 10 20 30 40 50 60 70 80 90 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:716] 1.07 1.07 1.07 1.07 1.07 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:716] 4.87 6.37 7.93 9.54 11.2 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:716] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:716] 0.2257 0.1342 0.0954 0.074 0.0604 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:716] 1.04 1.04 1.04 1.04 1.04 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:716] 1 0.993 0.985 0.978 0.97 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:716] 0.0127 0.0127 0.0127 0.0127 0.0127 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:716] 0.302 0.302 0.302 0.302 0.302 ...</span>
<span class="co">#&gt;  $ prod       :'data.frame': 14 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:14] 0 8072000 22549000 36369000 43473000 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:14] 1450 1450 1450 1450 1450 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ inj        :'data.frame': 14 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Wi: num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ We         : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ aquifer    :List of 3</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ We         : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "NoA" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:14] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ sorw       : num 0</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ p_est      : num [1:14] 7150 6710 5944 5252 4916 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "volumetric_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance-1" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance-1" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;    P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1      7150   0.00000000 0.000000e+00  0.000000000      0.00000     0.00000000</span>
<span class="co">#&gt; 2      6600   0.01458555 2.021415e-05  0.001602328      0.00220     0.02332055</span>
<span class="co">#&gt; 3      5800   0.03775399 5.761629e-05  0.003966834      0.00540     0.05923794</span>
<span class="co">#&gt; 4      4950   0.06642728 1.135771e-04  0.006524389      0.00880     0.10151519</span>
<span class="co">#&gt; 5      4500   0.08438586 1.539536e-04  0.007897815      0.01060     0.12670085</span>
<span class="co">#&gt; 6      4350   0.09253750 1.697488e-04  0.008358672      0.01120     0.13726543</span>
<span class="co">#&gt; 7      4060   0.11460682 2.044881e-04  0.009254036      0.01236     0.16400540</span>
<span class="co">#&gt; 8      3840   0.13793039 2.353071e-04  0.009937161      0.01324     0.19087721</span>
<span class="co">#&gt; 9      3600   0.17134421 2.744243e-04  0.010686248      0.01420     0.22816680</span>
<span class="co">#&gt; 10     3480   0.19175249 2.965592e-04  0.011062315      0.01468     0.25051492</span>
<span class="co">#&gt; 11     3260   0.23686709 3.425341e-04  0.011754428      0.01556     0.29918932</span>
<span class="co">#&gt; 12     3100   0.27708164 3.811749e-04  0.012259960      0.01620     0.34199561</span>
<span class="co">#&gt; 13     2940   0.32482944 4.251195e-04  0.012767337      0.01684     0.39233753</span>
<span class="co">#&gt; 14     2800   0.37393276 4.687258e-04  0.013212818      0.01740     0.44371265</span>
<span class="co">#&gt;    Egwf (bbl/SCF)  Et (bbl)   F (bbl) We Igd       Isd Inwd      Ifwd Iawd Itot</span>
<span class="co">#&gt; 1    0.000000e+00         0         0  0  NA        NA   NA        NA   NA   NA</span>
<span class="co">#&gt; 2    2.301691e-05  17632836  14077898  0   0 0.6254379    0 0.3745621    0    1</span>
<span class="co">#&gt; 3    6.450975e-05  44790236  39848802  0   0 0.6373278    0 0.3626722    0    1</span>
<span class="co">#&gt; 4    1.248356e-04  76756374  65314454  0   0 0.6543580    0 0.3456420    0    1</span>
<span class="co">#&gt; 5    1.675310e-04  95799434  78853117  0   0 0.6660244    0 0.3339756    0    1</span>
<span class="co">#&gt; 6    1.841005e-04 103787389  94100389  0   0 0.6741501    0 0.3258499    0    1</span>
<span class="co">#&gt; 7    2.203384e-04 124005672 122648176  0   0 0.6987991    0 0.3012009    0    1</span>
<span class="co">#&gt; 8    2.522960e-04 144323642 148788859  0   0 0.7226132    0 0.2773868    0    1</span>
<span class="co">#&gt; 9    2.926567e-04 172518572 173069325  0   0 0.7509603    0 0.2490397    0    1</span>
<span class="co">#&gt; 10   3.154141e-04 189416148 202511466  0   0 0.7654334    0 0.2345666    0    1</span>
<span class="co">#&gt; 11   3.625311e-04 226219215 234793745  0   0 0.7916963    0 0.2083037    0    1</span>
<span class="co">#&gt; 12   4.020036e-04 258585364 264650747  0   0 0.8101906    0 0.1898094    0    1</span>
<span class="co">#&gt; 13   4.467805e-04 296649251 295866353  0   0 0.8279337    0 0.1720663    0    1</span>
<span class="co">#&gt; 14   4.911157e-04 335494356 327934206  0   0 0.8427363    0 0.1572637    0    1</span>
<span class="co">#&gt;        RF_oil     RF_gas       SOo        SGo  SWo       SOT           SGT  SWT</span>
<span class="co">#&gt; 1  0.00000000 0.00000000 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 2  0.01337156 0.01337156 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 3  0.03352061 0.03352061 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 4  0.05652663 0.05652663 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 5  0.06985223 0.06985223 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 6  0.07174241 0.07797717 0.5485941 0.02140590 0.43 0.5485941  2.140590e-02 0.43</span>
<span class="co">#&gt; 7  0.07806987 0.09626897 0.5221388 0.04786120 0.43 0.5221388  4.786120e-02 0.43</span>
<span class="co">#&gt; 8  0.08314556 0.11422568 0.5031687 0.06683135 0.43 0.5031687  6.683135e-02 0.43</span>
<span class="co">#&gt; 9  0.09170741 0.13648697 0.4847327 0.08526726 0.43 0.4847327  8.526726e-02 0.43</span>
<span class="co">#&gt; 10 0.09224860 0.15160696 0.4739048 0.09609520 0.43 0.4739048  9.609520e-02 0.43</span>
<span class="co">#&gt; 11 0.09990233 0.17886100 0.4582064 0.11179363 0.43 0.4582064  1.117936e-01 0.43</span>
<span class="co">#&gt; 12 0.10502783 0.20172741 0.4470325 0.12296749 0.43 0.4470325  1.229675e-01 0.43</span>
<span class="co">#&gt; 13 0.11122887 0.22652508 0.4362948 0.13370515 0.43 0.4362948  1.337052e-01 0.43</span>
<span class="co">#&gt; 14 0.11690521 0.25017907 0.4269536 0.14304640 0.43 0.4269536  1.430464e-01 0.43</span>
<span class="co">#&gt;    qo (STB/day) qg (SCF/day) qw (STB/day)        fg fw GOR (SCF/STB)    krg/kro</span>
<span class="co">#&gt; 1         0.000            0            0 0.0000000  0      1449.989 0.00000000</span>
<span class="co">#&gt; 2     22115.068     32066603            0 0.0000000  0      1449.989 0.00000000</span>
<span class="co">#&gt; 3     39663.014     57510928            0 0.0000000  0      1449.989 0.00000000</span>
<span class="co">#&gt; 4     37863.014     54900948            0 0.0000000  0      1449.989 0.00000000</span>
<span class="co">#&gt; 5     19463.014     28221153            0 0.0000000  0      1449.989 0.00000000</span>
<span class="co">#&gt; 6     15641.096     39658811            0 0.3915718  0      2535.552 0.03720636</span>
<span class="co">#&gt; 7     25208.219     73638279            0 0.4962545  0      2921.201 0.05384999</span>
<span class="co">#&gt; 8     17613.699     67716986            0 0.6162464  0      3844.564 0.08766729</span>
<span class="co">#&gt; 9     13013.699     57559704            0 0.6984738  0      4423.009 0.11107716</span>
<span class="co">#&gt; 10    13726.027     75589808            0 0.7294254  0      5507.042 0.14993374</span>
<span class="co">#&gt; 11    10487.671     70743353            0 0.8088469  0      6745.382 0.19733650</span>
<span class="co">#&gt; 12     7876.712     62532808            0 0.8407946  0      7938.948 0.24331382</span>
<span class="co">#&gt; 13     7134.247     58476197            0 0.8568752  0      8196.548 0.25807072</span>
<span class="co">#&gt; 14     6909.589     55911277            0 0.8617173  0      8091.838 0.26003598</span></pre></body></html></div>
</div>
<div id="part-iii-reservoir-forecast-1" class="section level3">
<h3 class="hasAnchor">
<a href="#part-iii-reservoir-forecast-1" class="anchor"></a><code>Part III: Reservoir Forecast</code>
</h3>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="co"># Step I: generating a set of pseudo relative permeability curves by minimizing </span>
<span class="co"># the difference between field and theoretical 'fg' values</span>
<span class="co"># 'swcrit' and 'sgcrit' values are estimated from the 'mbal_results' data frame</span>

<span class="no">fun_fg</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">swcrit</span>, <span class="no">sgcrit</span>, <span class="no">muo</span>, <span class="no">mug</span>, <span class="no">sg</span>, <span class="no">fg</span>, <span class="no">krg_kro</span>) {
  <span class="no">Kr_table</span> <span class="kw">&lt;-</span> <span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">1</span>], <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">1</span>],
                                            <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">2</span>],
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">3</span>], <span class="kw">NG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">4</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">5</span>], <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>)
  <span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">fg</span>)
  <span class="no">krg_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span>(<span class="kw">length</span> <span class="kw">=</span> <span class="no">l</span>)
  <span class="no">kro_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span>(<span class="kw">length</span> <span class="kw">=</span> <span class="no">l</span>)
  <span class="no">krg_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">3</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
  <span class="no">kro_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">4</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
  <span class="no">fg_est</span> <span class="kw">&lt;-</span> (<span class="no">krg_est_sub</span> / <span class="no">mug</span>) / (<span class="no">krg_est_sub</span> / <span class="no">mug</span> + <span class="no">kro_est_sub</span> / <span class="no">muo</span>)
  <span class="no">krg_kro_est</span> <span class="kw">&lt;-</span> <span class="no">krg_est_sub</span> / <span class="no">kro_est_sub</span>
  <span class="no">error</span> <span class="kw">&lt;-</span> (<span class="no">fg</span> - <span class="no">fg_est</span>) ^ <span class="fl">2</span> + (<span class="no">krg_kro</span> - <span class="no">krg_kro_est</span>) ^ <span class="fl">2</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">error</span>)
}

<span class="no">swcrit</span> <span class="kw">&lt;-</span> <span class="fl">0.44</span>
<span class="no">sgcrit</span> <span class="kw">&lt;-</span> <span class="fl">0.015</span>
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">`P (psia)`</span>
<span class="no">sg</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">SGo</span>  <span class="co"># gas saturation in the oil leg</span>
<span class="no">fg</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">fg</span>   <span class="co"># in-situ gas fractional flow</span>
<span class="no">krg_kro</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">`krg/kro`</span>
<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">p</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">muo</span>, <span class="kw">xout</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">p</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">mug</span>, <span class="kw">xout</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">par</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>)
<span class="no">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>)
<span class="no">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span> - <span class="no">swcrit</span> - <span class="no">sgcrit</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>, <span class="fl">10.0</span>)
<span class="no">opt_results</span> <span class="kw">&lt;-</span> <span class="kw pkg">minpack.lm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html">nls.lm</a></span>(<span class="kw">par</span> <span class="kw">=</span> <span class="no">par</span>, <span class="kw">fn</span> <span class="kw">=</span> <span class="no">fun_fg</span>, <span class="kw">swcrit</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">sgcrit</span> <span class="kw">=</span> <span class="no">sgcrit</span>,
                                  <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">sg</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">fg</span> <span class="kw">=</span> <span class="no">fg</span>, <span class="kw">krg_kro</span> <span class="kw">=</span> <span class="no">krg_kro</span>,
                                  <span class="kw">lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">upper</span> <span class="kw">=</span> <span class="no">upper</span>)

<span class="no">opt_results</span>
<span class="co">#&gt; Nonlinear regression via the Levenberg-Marquardt algorithm</span>
<span class="co">#&gt; parameter estimates: 0, 1, 1, 0.805733179825336, 0.1 </span>
<span class="co">#&gt; residual sum-of-squares: 0.0006949</span>
<span class="co">#&gt; reason terminated: Relative error between `par' and the solution is at most `ptol'.</span>

<span class="no">sol</span> <span class="kw">&lt;-</span> <span class="no">opt_results</span>$<span class="no">par</span>

<span class="no">sol</span>
<span class="co">#&gt; [1] 0.0000000 1.0000000 1.0000000 0.8057332 0.1000000</span>

<span class="no">rel_perm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">1</span>], <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">1</span>],
                                            <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">2</span>],
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">3</span>], <span class="kw">NG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">4</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">5</span>],
                                            <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>))

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">rel_perm</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sg"</span>, <span class="st">"Sl"</span>, <span class="st">"Krg"</span>, <span class="st">"Krog"</span>)

<span class="no">krg_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">3</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">kro_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">4</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">fg_est</span> <span class="kw">&lt;-</span> (<span class="no">krg_est</span>/ <span class="no">mug</span>) / (<span class="no">krg_est</span> / <span class="no">mug</span> + <span class="no">kro_est</span> / <span class="no">muo</span>)

<span class="no">fg_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Sg</span> <span class="kw">=</span> <span class="no">sg</span>)

<span class="no">fg_df</span>$<span class="no">fg</span> <span class="kw">&lt;-</span> <span class="no">fg_est</span>

<span class="no">p_fg</span> <span class="kw">&lt;-</span> <span class="no">fg_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">sg</span>, <span class="no">fg</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Model"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">SGo</span>, <span class="no">fg</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Model"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Gas Frational Flow Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p_fg</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="no">p_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">p</span>, <span class="fl">2600</span>, <span class="fl">2400</span>, <span class="fl">2200</span>, <span class="fl">2000</span>, <span class="fl">1800</span>, <span class="fl">1600</span>, <span class="fl">1400</span>, <span class="fl">1200</span>)

<span class="no">Gi_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Gi</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>)

<span class="no">wf_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">wf</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>)

<span class="no">time_lst_forecast</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fl">1</span>:<span class="fl">22</span>, <span class="st">"year"</span>)

<span class="no">forecast_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_param_oil.html">mbal_forecast_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                        <span class="kw">N</span> <span class="kw">=</span> <span class="fl">6.35e8</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.43</span>,
                                        <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi_forecast</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">4500</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p_forecast</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>,
                                        <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">4e-6</span>, <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf_forecast</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">rel_perm</span> <span class="kw">=</span> <span class="no">rel_perm</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">forecast_lst</span>)
<span class="co">#&gt; List of 14</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 6.35e+08</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.1</span>
<span class="co">#&gt;  $ swi        : num 0.43</span>
<span class="co">#&gt;  $ pb         : num 4500</span>
<span class="co">#&gt;  $ p          : num [1:22] 7150 6600 5800 4950 4500 4350 4060 3840 3600 3480 ...</span>
<span class="co">#&gt;  $ cf         : num [1:22] 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 ...</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 716 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:716] 0 10 20 30 40 50 60 70 80 90 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:716] 1.07 1.07 1.07 1.07 1.07 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:716] 4.87 6.37 7.93 9.54 11.2 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:716] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:716] 0.2257 0.1342 0.0954 0.074 0.0604 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:716] 1.04 1.04 1.04 1.04 1.04 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:716] 1 0.993 0.985 0.978 0.97 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:716] 0.0127 0.0127 0.0127 0.0127 0.0127 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:716] 0.302 0.302 0.302 0.302 0.302 ...</span>
<span class="co">#&gt;  $ inj        :'data.frame': 22 obs. of  1 variable:</span>
<span class="co">#&gt;   ..$ Gi: num [1:22] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ wf         : num [1:22] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ rel_perm   :'data.frame': 101 obs. of  4 variables:</span>
<span class="co">#&gt;   ..$ Sg  : num [1:101] 0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 ...</span>
<span class="co">#&gt;   ..$ Sl  : num [1:101] 1 0.99 0.98 0.97 0.96 0.95 0.94 0.93 0.92 0.91 ...</span>
<span class="co">#&gt;   ..$ Krg : num [1:101] 0 0 0.0228 0.0553 0.0835 ...</span>
<span class="co">#&gt;   ..$ Krog: num [1:101] 1 1 0.999 0.997 0.995 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "volumetric_forecast_oil" "forecast_oil"</span>



<span class="no">forecast_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_oil.html">mbal_forecast_oil</a></span>(<span class="no">forecast_lst</span>, <span class="no">time_lst_forecast</span>)

<span class="no">forecast_results</span>
<span class="co">#&gt;    P (psia)       SOo        SGo  SWo       SOT           SGT  SWT</span>
<span class="co">#&gt; 1      7150 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 2      6600 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 3      5800 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 4      4950 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 5      4500 0.5700000 0.00000000 0.43 0.5700000 -5.551115e-17 0.43</span>
<span class="co">#&gt; 6      4350 0.5432257 0.02677428 0.43 0.5432257  2.677428e-02 0.43</span>
<span class="co">#&gt; 7      4060 0.5198733 0.05012674 0.43 0.5198733  5.012674e-02 0.43</span>
<span class="co">#&gt; 8      3840 0.5028741 0.06712593 0.43 0.5028741  6.712593e-02 0.43</span>
<span class="co">#&gt; 9      3600 0.4848529 0.08514707 0.43 0.4848529  8.514707e-02 0.43</span>
<span class="co">#&gt; 10     3480 0.4760302 0.09396976 0.43 0.4760302  9.396976e-02 0.43</span>
<span class="co">#&gt; 11     3260 0.4601576 0.10984240 0.43 0.4601576  1.098424e-01 0.43</span>
<span class="co">#&gt; 12     3100 0.4488558 0.12114422 0.43 0.4488558  1.211442e-01 0.43</span>
<span class="co">#&gt; 13     2940 0.4377526 0.13224743 0.43 0.4377526  1.322474e-01 0.43</span>
<span class="co">#&gt; 14     2800 0.4281989 0.14180107 0.43 0.4281989  1.418011e-01 0.43</span>
<span class="co">#&gt; 15     2600 0.4148094 0.15519059 0.43 0.4148094  1.551906e-01 0.43</span>
<span class="co">#&gt; 16     2400 0.4017250 0.16827499 0.43 0.4017250  1.682750e-01 0.43</span>
<span class="co">#&gt; 17     2200 0.3889460 0.18105395 0.43 0.3889460  1.810540e-01 0.43</span>
<span class="co">#&gt; 18     2000 0.3764732 0.19352677 0.43 0.3764732  1.935268e-01 0.43</span>
<span class="co">#&gt; 19     1800 0.3643071 0.20569292 0.43 0.3643071  2.056929e-01 0.43</span>
<span class="co">#&gt; 20     1600 0.3524466 0.21755341 0.43 0.3524466  2.175534e-01 0.43</span>
<span class="co">#&gt; 21     1400 0.3408869 0.22911308 0.43 0.3408869  2.291131e-01 0.43</span>
<span class="co">#&gt; 22     1200 0.3296154 0.24038459 0.43 0.3296154  2.403846e-01 0.43</span>
<span class="co">#&gt;    GOR (SCF/STB)     RF_oil     RF_gas Liq_volume Igd       Isd Inwd       Ifwd</span>
<span class="co">#&gt; 1       1449.989 0.00000000 0.00000000  1.0000000  NA        NA   NA         NA</span>
<span class="co">#&gt; 2       1449.989 0.01337156 0.01337156  1.0000000   0 0.6254379    0 0.37456213</span>
<span class="co">#&gt; 3       1449.989 0.03352061 0.03352061  1.0000000   0 0.6373278    0 0.36267220</span>
<span class="co">#&gt; 4       1449.989 0.05652663 0.05652663  1.0000000   0 0.6543580    0 0.34564203</span>
<span class="co">#&gt; 5       1449.989 0.06985223 0.06985223  1.0000000   0 0.6660244    0 0.33397557</span>
<span class="co">#&gt; 6       2772.826 0.07419549 0.07617669  0.9771222   0 0.6741501    0 0.32584994</span>
<span class="co">#&gt; 7       4645.716 0.08121915 0.09414418  0.9309889   0 0.6987991    0 0.30120093</span>
<span class="co">#&gt; 8       5795.180 0.08625326 0.11226867  0.8941984   0 0.7226132    0 0.27738681</span>
<span class="co">#&gt; 9       6903.398 0.09177503 0.13644770  0.8521475   0 0.7509603    0 0.24903969</span>
<span class="co">#&gt; 10      7408.564 0.09458359 0.15030850  0.8303216   0 0.7654334    0 0.23456660</span>
<span class="co">#&gt; 11      8256.700 0.09987213 0.17887643  0.7888277   0 0.7916963    0 0.20830366</span>
<span class="co">#&gt; 12      8807.561 0.10385118 0.20229020  0.7573803   0 0.8101906    0 0.18980936</span>
<span class="co">#&gt; 13      9302.492 0.10796484 0.22797957  0.7248040   0 0.8279337    0 0.17206634</span>
<span class="co">#&gt; 14      9687.291 0.11168735 0.25235550  0.6953362   0 0.8427363    0 0.15726370</span>
<span class="co">#&gt; 15     10151.341 0.11723108 0.29027999  0.6516276   0 0.8626041    0 0.13739589</span>
<span class="co">#&gt; 16     10506.016 0.12306683 0.33184968  0.6059898   0 0.8809038    0 0.11909615</span>
<span class="co">#&gt; 17     10737.990 0.12922887 0.37699011  0.5584429   0 0.8976251    0 0.10237487</span>
<span class="co">#&gt; 18     10834.037 0.13575496 0.42553572  0.5090931   0 0.9128009    0 0.08719912</span>
<span class="co">#&gt; 19     10782.211 0.14268843 0.47721736  0.4581546   0 0.9264925    0 0.07350751</span>
<span class="co">#&gt; 20     10570.656 0.15008228 0.53165910  0.4059629   0 0.9387813    0 0.06121874</span>
<span class="co">#&gt; 21     10188.658 0.15800687 0.58838679  0.3529695   0 0.9497635    0 0.05023645</span>
<span class="co">#&gt; 22      9625.463 0.16656300 0.64684659  0.2997166   0 0.9595472    0 0.04045282</span>
<span class="co">#&gt;    Iawd Itot</span>
<span class="co">#&gt; 1    NA   NA</span>
<span class="co">#&gt; 2     0    1</span>
<span class="co">#&gt; 3     0    1</span>
<span class="co">#&gt; 4     0    1</span>
<span class="co">#&gt; 5     0    1</span>
<span class="co">#&gt; 6     0    1</span>
<span class="co">#&gt; 7     0    1</span>
<span class="co">#&gt; 8     0    1</span>
<span class="co">#&gt; 9     0    1</span>
<span class="co">#&gt; 10    0    1</span>
<span class="co">#&gt; 11    0    1</span>
<span class="co">#&gt; 12    0    1</span>
<span class="co">#&gt; 13    0    1</span>
<span class="co">#&gt; 14    0    1</span>
<span class="co">#&gt; 15    0    1</span>
<span class="co">#&gt; 16    0    1</span>
<span class="co">#&gt; 17    0    1</span>
<span class="co">#&gt; 18    0    1</span>
<span class="co">#&gt; 19    0    1</span>
<span class="co">#&gt; 20    0    1</span>
<span class="co">#&gt; 21    0    1</span>
<span class="co">#&gt; 22    0    1</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`Liq_volume`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"CCE Liquid Volume Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-5.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">

<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Isd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p5</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-7-6.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-3-saturated-black-oil-reservoir-with-gas-cap-dake1983" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3-saturated-black-oil-reservoir-with-gas-cap-dake1983" class="anchor"></a><code>Example 3: Saturated Black Oil Reservoir with Gas Cap</code> <font size="2"> <span class="citation">(Dake, 1983)</span> </font>
</h2>
<div id="part-i-history-match-2" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match-2" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">p_pvt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3330</span>, <span class="fl">3150</span>, <span class="fl">3000</span>, <span class="fl">2850</span>, <span class="fl">2700</span>, <span class="fl">2550</span>, <span class="fl">2400</span>)

<span class="no">Bo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.2511</span>, <span class="fl">1.2353</span>, <span class="fl">1.2222</span>, <span class="fl">1.2122</span>, <span class="fl">1.2022</span>, <span class="fl">1.1922</span>, <span class="fl">1.1822</span>)

<span class="no">Rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">510</span>, <span class="fl">477</span>, <span class="fl">450</span>, <span class="fl">425</span>, <span class="fl">401</span>, <span class="fl">375</span>, <span class="fl">352</span>)

<span class="no">Bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.00087</span>, <span class="fl">0.00092</span>, <span class="fl">0.00096</span>, <span class="fl">0.00101</span>, <span class="fl">0.00107</span>, <span class="fl">0.00113</span>, <span class="fl">0.00120</span>)

<span class="no">cw</span> <span class="kw">&lt;-</span> <span class="fl">2e-6</span>

<span class="no">Bwi</span> <span class="kw">&lt;-</span> <span class="fl">1.0</span>

<span class="no">Bw</span> <span class="kw">&lt;-</span> <span class="no">Bwi</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">cw</span> * (<span class="no">p_pvt</span>[<span class="fl">1</span>] - <span class="no">p_pvt</span>))

<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.02</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p_pvt</span>, <span class="kw">Bo</span> <span class="kw">=</span> <span class="no">Bo</span>, <span class="kw">Rs</span> <span class="kw">=</span> <span class="no">Rs</span>, <span class="kw">Rv</span> <span class="kw">=</span> <span class="no">Rv</span>, <span class="kw">Bg</span> <span class="kw">=</span> <span class="no">Bg</span>,
                               <span class="kw">Bw</span> <span class="kw">=</span> <span class="no">Bw</span>, <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">muw</span> <span class="kw">=</span> <span class="no">muw</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3330</span>, <span class="fl">3150</span>, <span class="fl">3000</span>, <span class="fl">2850</span>, <span class="fl">2700</span>, <span class="fl">2550</span>, <span class="fl">2400</span>)

<span class="no">We</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">3.295</span>, <span class="fl">5.903</span>, <span class="fl">8.852</span>, <span class="fl">11.503</span>, <span class="fl">14.513</span>, <span class="fl">17.730</span>) * <span class="fl">1e6</span>

<span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1050</span>, <span class="fl">1060</span>, <span class="fl">1160</span>, <span class="fl">1235</span>, <span class="fl">1265</span>, <span class="fl">1300</span>)

<span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>)

<span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                          <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"N_m"</span>, <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                                          <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>,
                                          <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>, <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>, <span class="kw">We</span> <span class="kw">=</span> <span class="no">We</span>,
                                          <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">3330</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>, <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">0</span>,
                                          <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">365</span>, <span class="fl">730</span>, <span class="fl">1095</span>, <span class="fl">1460</span>, <span class="fl">1825</span>, <span class="fl">2190</span>), <span class="st">"day"</span>)

<span class="co"># a number of plots will be automatically generated for quality check</span>

<span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-8-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-8-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r">
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 1.37e+08</span>
<span class="co">#&gt;  $ m          : num 0.377</span>
<span class="co">#&gt;  $ phi        : num 0.2</span>
<span class="co">#&gt;  $ swi        : num 0.2</span>
<span class="co">#&gt;  $ pb         : num 3330</span>
<span class="co">#&gt;  $ p          : num [1:7] 3330 3150 3000 2850 2700 2550 2400</span>
<span class="co">#&gt;  $ cf         : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 7 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:7] 3330 3150 3000 2850 2700 2550 2400</span>
<span class="co">#&gt;   ..$ Bo : num [1:7] 1.25 1.24 1.22 1.21 1.2 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:7] 510 477 450 425 401 375 352</span>
<span class="co">#&gt;   ..$ Rv : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Bg : num [1:7] 0.00087 0.00092 0.00096 0.00101 0.00107 0.00113 0.0012</span>
<span class="co">#&gt;   ..$ Bw : num [1:7] 1 1 1 1 1 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:7] 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="co">#&gt;   ..$ mug: num [1:7] 0.02 0.02 0.02 0.02 0.02 0.02 0.02</span>
<span class="co">#&gt;   ..$ muw: num [1:7] 0.25 0.25 0.25 0.25 0.25 0.25 0.25</span>
<span class="co">#&gt;  $ prod       :'data.frame': 7 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:7] 0 3295000 5903000 8852000 11503000 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:7] 510 1050 1060 1160 1235 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ inj        :'data.frame': 7 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Wi: num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ We         : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ aquifer    :List of 3</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ We         : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "NoA" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:7] 1 1 1 0 1 0 1</span>
<span class="co">#&gt;  $ sorw       : num 0</span>
<span class="co">#&gt;  $ sorg       : num 0.2</span>
<span class="co">#&gt;  $ p_est      : num [1:5] 3330 3147 2999 2702 NA</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "gas_cap_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance-2" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance-2" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb17"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;   P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1     3330      0.00000      0.00000 0.0000000000            0     0.00000000</span>
<span class="co">#&gt; 2     3150      0.01456      0.00005 0.0003600648            0     0.01467262</span>
<span class="co">#&gt; 3     3000      0.02870      0.00009 0.0006602178            0     0.02890650</span>
<span class="co">#&gt; 4     2700      0.06773      0.00020 0.0012607941            0     0.06812434</span>
<span class="co">#&gt; 5     2400      0.12070      0.00033 0.0018617309            0     0.12128230</span>
<span class="co">#&gt;   Egwf (bbl/SCF) Et (bbl)  F (bbl) We       Igd       Isd Inwd        Ifwd Iawd</span>
<span class="co">#&gt; 1   0.000000e+00        0        0  0        NA        NA   NA          NA   NA</span>
<span class="co">#&gt; 2   5.007831e-05  5722033  5807306  0 0.6481408 0.3481511    0 0.003708064    0</span>
<span class="co">#&gt; 3   9.014360e-05 10641333 10671443  0 0.6273302 0.3690138    0 0.003656017    0</span>
<span class="co">#&gt; 4   2.002742e-04 24175999 24093954  0 0.6136140 0.3833129    0 0.003073100    0</span>
<span class="co">#&gt; 5   3.304049e-04 41101462 41130054  0 0.5955338 0.4017971    0 0.002669172    0</span>
<span class="co">#&gt;   Itot     RF_oil     RF_gas       SOo        SGo SWo       SOT       SGT SWT</span>
<span class="co">#&gt; 1   NA 0.00000000 0.00000000 0.8000000 0.00000000 0.2 0.5809809 0.2190191 0.2</span>
<span class="co">#&gt; 2    1 0.02372872 0.02368098 0.7833190 0.01668101 0.2 0.5598291 0.2401709 0.2</span>
<span class="co">#&gt; 3    1 0.04302183 0.04334418 0.7692774 0.03072257 0.2 0.5430738 0.2569262 0.2</span>
<span class="co">#&gt; 4    1 0.08435887 0.09902245 0.7520598 0.04794024 0.2 0.5113374 0.2886626 0.2</span>
<span class="co">#&gt; 5    1 0.12949410 0.16000344 0.7344800 0.06551996 0.2 0.4778455 0.3221545 0.2</span>
<span class="co">#&gt;   qo (STB/day) qg (SCF/day) qw (STB/day)        fg fw GOR (SCF/STB)    krg/kro</span>
<span class="co">#&gt; 1        0.000            0            0 0.0000000  0       510.000 0.00000000</span>
<span class="co">#&gt; 2     9027.397      9478767            0 0.2991047  0      1050.000 0.01706986</span>
<span class="co">#&gt; 3     7145.205      7664192            0 0.3403058  0      1072.634 0.01956239</span>
<span class="co">#&gt; 4     7671.233     10889075            0 0.4878215  0      1419.469 0.03625891</span>
<span class="co">#&gt; 5     8530.137     12113418            0 0.5404484  0      1420.073 0.04336619</span></pre></body></html></div>
</div>
<div id="part-iii-reservoir-forecast-2" class="section level3">
<h3 class="hasAnchor">
<a href="#part-iii-reservoir-forecast-2" class="anchor"></a><code>Part III: Reservoir Forecast</code>
</h3>
<div class="sourceCode" id="cb18"><html><body><pre class="r">
<span class="co"># Step I: generating a set of pseudo relative permeability curves by minimizing </span>
<span class="co"># the difference between field and theoretical 'fg' values</span>
<span class="co"># 'swcrit' and 'sgcrit' values are estimated from the 'mbal_results' data frame</span>

<span class="no">fun_fg</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">swcrit</span>, <span class="no">sgcrit</span>, <span class="no">muo</span>, <span class="no">mug</span>, <span class="no">sg</span>, <span class="no">fg</span>, <span class="no">krg_kro</span>) {
  <span class="no">Kr_table</span> <span class="kw">&lt;-</span> <span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">1</span>], <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">1</span>],
                                            <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">2</span>],
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">3</span>], <span class="kw">NG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">4</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">5</span>], <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>)
  <span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">fg</span>)
  <span class="no">krg_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span>(<span class="kw">length</span> <span class="kw">=</span> <span class="no">l</span>)
  <span class="no">kro_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span>(<span class="kw">length</span> <span class="kw">=</span> <span class="no">l</span>)
  <span class="no">krg_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">3</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
  <span class="no">kro_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">Kr_table</span>[,<span class="fl">4</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
  <span class="no">fg_est</span> <span class="kw">&lt;-</span> (<span class="no">krg_est_sub</span> / <span class="no">mug</span>) / (<span class="no">krg_est_sub</span> / <span class="no">mug</span> + <span class="no">kro_est_sub</span> / <span class="no">muo</span>)
  <span class="no">krg_kro_est</span> <span class="kw">&lt;-</span> <span class="no">krg_est_sub</span> / <span class="no">kro_est_sub</span>
  <span class="no">error</span> <span class="kw">&lt;-</span> (<span class="no">fg</span> - <span class="no">fg_est</span>) ^ <span class="fl">2</span> + (<span class="no">krg_kro</span> - <span class="no">krg_kro_est</span>) ^ <span class="fl">2</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">error</span>)
}

<span class="no">swcrit</span> <span class="kw">&lt;-</span> <span class="fl">0.2</span>
<span class="no">sgcrit</span> <span class="kw">&lt;-</span> <span class="fl">0.00</span>
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">`P (psia)`</span>
<span class="no">sg</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">SGo</span>  <span class="co"># gas saturation in the oil leg</span>
<span class="no">fg</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">fg</span>   <span class="co"># in-situ gas fractional flow</span>
<span class="no">krg_kro</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>$<span class="no">`krg/kro`</span>
<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">p</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">muo</span>, <span class="kw">xout</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>
<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">p</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pvt_table</span>$<span class="no">mug</span>, <span class="kw">xout</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">par</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">3</span>, <span class="fl">3</span>)
<span class="no">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>)
<span class="no">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span> - <span class="no">swcrit</span> - <span class="no">sgcrit</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>, <span class="fl">10.0</span>)
<span class="no">opt_results</span> <span class="kw">&lt;-</span> <span class="kw pkg">minpack.lm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html">nls.lm</a></span>(<span class="kw">par</span> <span class="kw">=</span> <span class="no">par</span>, <span class="kw">fn</span> <span class="kw">=</span> <span class="no">fun_fg</span>, <span class="kw">swcrit</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">sgcrit</span> <span class="kw">=</span> <span class="no">sgcrit</span>,
                                  <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">sg</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">fg</span> <span class="kw">=</span> <span class="no">fg</span>, <span class="kw">krg_kro</span> <span class="kw">=</span> <span class="no">krg_kro</span>,
                                  <span class="kw">lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">upper</span> <span class="kw">=</span> <span class="no">upper</span>)

<span class="no">opt_results</span>
<span class="co">#&gt; Nonlinear regression via the Levenberg-Marquardt algorithm</span>
<span class="co">#&gt; parameter estimates: 0, 0.3, 1, 0.926585263186008, 10 </span>
<span class="co">#&gt; residual sum-of-squares: 0.000173</span>
<span class="co">#&gt; reason terminated: Relative error between `par' and the solution is at most `ptol'.</span>

<span class="no">sol</span> <span class="kw">&lt;-</span> <span class="no">opt_results</span>$<span class="no">par</span>

<span class="no">sol</span>
<span class="co">#&gt; [1]  0.0000000  0.3000000  1.0000000  0.9265853 10.0000000</span>

<span class="no">rel_perm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">1</span>], <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">1</span>],
                                            <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">2</span>],
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">3</span>], <span class="kw">NG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">4</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">5</span>],
                                            <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>))

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">rel_perm</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sg"</span>, <span class="st">"Sl"</span>, <span class="st">"Krg"</span>, <span class="st">"Krog"</span>)

<span class="no">krg_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">3</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">kro_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">rel_perm</span>[,<span class="fl">4</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

<span class="no">fg_est</span> <span class="kw">&lt;-</span> (<span class="no">krg_est</span>/ <span class="no">mug</span>) / (<span class="no">krg_est</span> / <span class="no">mug</span> + <span class="no">kro_est</span> / <span class="no">muo</span>)

<span class="no">fg_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Sg</span> <span class="kw">=</span> <span class="no">sg</span>)

<span class="no">fg_df</span>$<span class="no">fg</span> <span class="kw">&lt;-</span> <span class="no">fg_est</span>

<span class="no">p_fg</span> <span class="kw">&lt;-</span> <span class="no">fg_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">sg</span>, <span class="no">fg</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Model"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">SGo</span>, <span class="no">fg</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Model"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Gas Frational Flow Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p_fg</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><html><body><pre class="r">
<span class="no">p_forecast</span> <span class="kw">&lt;-</span> <span class="no">p_pvt</span>

<span class="no">Gi_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Gi</span>)

<span class="no">wf_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">wf</span>)

<span class="no">time_lst_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">365</span>, <span class="fl">730</span>, <span class="fl">1095</span>, <span class="fl">1460</span>, <span class="fl">1825</span>, <span class="fl">2190</span>), <span class="st">"day"</span>)

<span class="no">forecast_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_param_oil.html">mbal_forecast_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                        <span class="kw">N</span> <span class="kw">=</span> <span class="fl">1.37e8</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0.377</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.2</span>,
                                        <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi_forecast</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">3330</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p_forecast</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>,
                                        <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf_forecast</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">rel_perm</span> <span class="kw">=</span> <span class="no">rel_perm</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">forecast_lst</span>)
<span class="co">#&gt; List of 14</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 1.37e+08</span>
<span class="co">#&gt;  $ m          : num 0.377</span>
<span class="co">#&gt;  $ phi        : num 0.2</span>
<span class="co">#&gt;  $ swi        : num 0.2</span>
<span class="co">#&gt;  $ pb         : num 3330</span>
<span class="co">#&gt;  $ p          : num [1:7] 3330 3150 3000 2850 2700 2550 2400</span>
<span class="co">#&gt;  $ cf         : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 7 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:7] 3330 3150 3000 2850 2700 2550 2400</span>
<span class="co">#&gt;   ..$ Bo : num [1:7] 1.25 1.24 1.22 1.21 1.2 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:7] 510 477 450 425 401 375 352</span>
<span class="co">#&gt;   ..$ Rv : num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Bg : num [1:7] 0.00087 0.00092 0.00096 0.00101 0.00107 0.00113 0.0012</span>
<span class="co">#&gt;   ..$ Bw : num [1:7] 1 1 1 1 1 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:7] 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="co">#&gt;   ..$ mug: num [1:7] 0.02 0.02 0.02 0.02 0.02 0.02 0.02</span>
<span class="co">#&gt;   ..$ muw: num [1:7] 0.25 0.25 0.25 0.25 0.25 0.25 0.25</span>
<span class="co">#&gt;  $ inj        :'data.frame': 7 obs. of  1 variable:</span>
<span class="co">#&gt;   ..$ Gi: num [1:7] 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ wf         : num [1:7] 1 1 1 0 1 0 1</span>
<span class="co">#&gt;  $ sorg       : num 0.2</span>
<span class="co">#&gt;  $ rel_perm   :'data.frame': 101 obs. of  4 variables:</span>
<span class="co">#&gt;   ..$ Sg  : num [1:101] 0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 ...</span>
<span class="co">#&gt;   ..$ Sl  : num [1:101] 1 0.99 0.98 0.97 0.96 0.95 0.94 0.93 0.92 0.91 ...</span>
<span class="co">#&gt;   ..$ Krg : num [1:101] 0 0.00517 0.00983 0.01432 0.01869 ...</span>
<span class="co">#&gt;   ..$ Krog: num [1:101] 1 0.882 0.776 0.682 0.599 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "gas_cap_forecast_oil" "forecast_oil"</span>


<span class="no">forecast_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_oil.html">mbal_forecast_oil</a></span>(<span class="no">forecast_lst</span>, <span class="no">time_lst_forecast</span>)

<span class="no">forecast_results</span>
<span class="co">#&gt;   P (psia)       SOo        SGo SWo       SOT       SGT SWT GOR (SCF/STB)</span>
<span class="co">#&gt; 1     3330 0.8000000 0.00000000 0.2 0.5809731 0.2190269 0.2      510.0000</span>
<span class="co">#&gt; 2     3150 0.7790250 0.02097502 0.2 0.5571724 0.2428276 0.2      926.3694</span>
<span class="co">#&gt; 3     3000 0.7648711 0.03512886 0.2 0.5404104 0.2595896 0.2     1274.2193</span>
<span class="co">#&gt; 4     2700 0.7481436 0.05185644 0.2 0.5091204 0.2908796 0.2     1704.3453</span>
<span class="co">#&gt; 5     2400 0.7379930 0.06200705 0.2 0.4796626 0.3203374 0.2     1898.0197</span>
<span class="co">#&gt;       RF_oil     RF_gas Liq_volume       Igd       Isd Inwd        Ifwd Iawd</span>
<span class="co">#&gt; 1 0.00000000 0.00000000  1.0000000        NA        NA   NA          NA   NA</span>
<span class="co">#&gt; 2 0.02870061 0.01959081  0.9760125 0.6481519 0.3481401    0 0.003707997    0</span>
<span class="co">#&gt; 3 0.04782355 0.03958891  0.9549930 0.6273415 0.3690025    0 0.003655953    0</span>
<span class="co">#&gt; 4 0.08803163 0.09650242  0.9115656 0.6136256 0.3833014    0 0.003073049    0</span>
<span class="co">#&gt; 5 0.12626274 0.16195092  0.8617874 0.5955455 0.4017854    0 0.002669130    0</span>
<span class="co">#&gt;   Itot</span>
<span class="co">#&gt; 1   NA</span>
<span class="co">#&gt; 2    1</span>
<span class="co">#&gt; 3    1</span>
<span class="co">#&gt; 4    1</span>
<span class="co">#&gt; 5    1</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">mbal_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`Liq_volume`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"CCE Liquid Volume Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-5.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r">

<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Igd"</span>, <span class="st">"Isd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p5</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-10-6.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-4-water-drive-saturated-black-oil-reservoir-dake1983" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-water-drive-saturated-black-oil-reservoir-dake1983" class="anchor"></a><code>Example 4: Water-Drive Saturated Black Oil Reservoir</code> <font size="2"> <span class="citation">(Dake, 1983)</span> </font>
</h2>
<div id="part-i-history-match-3" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match-3" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">p_pvt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2740</span>, <span class="fl">2500</span>, <span class="fl">2290</span>, <span class="fl">2109</span>, <span class="fl">1949</span>, <span class="fl">1818</span>, <span class="fl">1702</span>, <span class="fl">1608</span>, <span class="fl">1535</span>, <span class="fl">1480</span>, <span class="fl">1440</span>)

<span class="no">Bo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.404</span>, <span class="fl">1.374</span>, <span class="fl">1.349</span>, <span class="fl">1.329</span>, <span class="fl">1.316</span>, <span class="fl">1.303</span>, <span class="fl">1.294</span>, <span class="fl">1.287</span>, <span class="fl">1.280</span>, <span class="fl">1.276</span>, <span class="fl">1.273</span>)

<span class="no">Rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">650</span>, <span class="fl">592</span>, <span class="fl">545</span>, <span class="fl">507</span>, <span class="fl">471</span>, <span class="fl">442</span>, <span class="fl">418</span>, <span class="fl">398</span>, <span class="fl">383</span>, <span class="fl">371</span>, <span class="fl">364</span>)

<span class="no">Bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.00093</span>, <span class="fl">0.00098</span>, <span class="fl">0.00107</span>, <span class="fl">0.00117</span>, <span class="fl">0.00128</span>, <span class="fl">0.00139</span>, <span class="fl">0.00150</span>, <span class="fl">0.00160</span>,
        <span class="fl">0.00170</span>, <span class="fl">0.00176</span>, <span class="fl">0.00182</span>)

<span class="no">cw</span> <span class="kw">&lt;-</span> <span class="fl">3e-6</span>

<span class="no">Bwi</span> <span class="kw">&lt;-</span> <span class="fl">1.0</span>

<span class="no">Bw</span> <span class="kw">&lt;-</span> <span class="no">Bwi</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">cw</span> * (<span class="no">p_pvt</span>[<span class="fl">1</span>] - <span class="no">p_pvt</span>))

<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.55</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.02</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p_pvt</span>, <span class="kw">Bo</span> <span class="kw">=</span> <span class="no">Bo</span>, <span class="kw">Rs</span> <span class="kw">=</span> <span class="no">Rs</span>, <span class="kw">Rv</span> <span class="kw">=</span> <span class="no">Rv</span>, <span class="kw">Bg</span> <span class="kw">=</span> <span class="no">Bg</span>,
                               <span class="kw">Bw</span> <span class="kw">=</span> <span class="no">Bw</span>, <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">muw</span> <span class="kw">=</span> <span class="no">muw</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2740</span>, <span class="fl">2500</span>, <span class="fl">2290</span>, <span class="fl">2109</span>, <span class="fl">1949</span>, <span class="fl">1818</span>, <span class="fl">1702</span>, <span class="fl">1608</span>, <span class="fl">1535</span>, <span class="fl">1480</span>, <span class="fl">1440</span>)

<span class="no">We</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">7.88</span>, <span class="fl">18.42</span>, <span class="fl">29.15</span>, <span class="fl">40.69</span>, <span class="fl">50.14</span>, <span class="fl">58.42</span>, <span class="fl">65.39</span>, <span class="fl">70.74</span>, <span class="fl">74.54</span>, <span class="fl">77.43</span>) * <span class="fl">1e6</span>

<span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">760</span>, <span class="fl">845</span>, <span class="fl">920</span>, <span class="fl">975</span>, <span class="fl">1025</span>, <span class="fl">1065</span>, <span class="fl">1095</span>, <span class="fl">1120</span>, <span class="fl">1145</span>, <span class="fl">1160</span>)

<span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                           <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"We"</span>,
                                           <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="st">"pss_rad_edge"</span>, <span class="kw">N</span> <span class="kw">=</span> <span class="fl">312e6</span>,
                                           <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>, <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>,
                                           <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>, <span class="kw">We</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">2740</span>,
                                           <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>, <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">4e-6</span>,
                                           <span class="kw">phi_a</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">perm_h_a</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">h_a</span> <span class="kw">=</span> <span class="fl">100</span>,
                                           <span class="kw">r_a</span> <span class="kw">=</span> <span class="fl">5</span> * <span class="fl">9200</span>, <span class="kw">r_R</span> <span class="kw">=</span> <span class="fl">9200</span>, <span class="kw">tetha</span> <span class="kw">=</span> <span class="fl">140</span>,
                                           <span class="kw">muw_a</span> <span class="kw">=</span> <span class="fl">0.55</span>, <span class="kw">cw_a</span> <span class="kw">=</span> <span class="fl">3e-6</span>, <span class="kw">cf_a</span> <span class="kw">=</span> <span class="fl">4e-6</span>,
                                           <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>,
                                           <span class="kw">mult_len</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>), <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">Inf</span>, <span class="fl">1</span>),
                                           <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">Inf</span>, <span class="fl">1</span>),
                                           <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">maxiter</span> <span class="kw">=</span> <span class="fl">100</span>), )

<span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fl">0</span>:<span class="fl">10</span>, <span class="st">"year"</span>)

<span class="co"># a number of plots will be automatically generated for quality check</span>

<span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-11-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-11-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><html><body><pre class="r">
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 3.12e+08</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.25</span>
<span class="co">#&gt;  $ swi        : num 0.25</span>
<span class="co">#&gt;  $ pb         : num 2740</span>
<span class="co">#&gt;  $ p          : num [1:11] 2740 2500 2290 2109 1949 ...</span>
<span class="co">#&gt;  $ cf         : num [1:11] 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 4e-06 ...</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 11 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:11] 2740 2500 2290 2109 1949 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:11] 1.4 1.37 1.35 1.33 1.32 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:11] 650 592 545 507 471 442 418 398 383 371 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:11] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Bg : num [1:11] 0.00093 0.00098 0.00107 0.00117 0.00128 0.00139 0.0015 0.0016 0.0017 0.00176 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:11] 1 1 1 1 1 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:11] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</span>
<span class="co">#&gt;   ..$ mug: num [1:11] 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 ...</span>
<span class="co">#&gt;   ..$ muw: num [1:11] 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 ...</span>
<span class="co">#&gt;  $ prod       :'data.frame': 11 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:11] 0 7880000 18420000 29150000 40690000 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:11] 650 760 845 920 975 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:11] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ inj        :'data.frame': 11 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:11] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..$ Wi: num [1:11] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ We         : NULL</span>
<span class="co">#&gt;  $ aquifer    :List of 14</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ model      : chr "pss_rad_edge"</span>
<span class="co">#&gt;   ..$ phi        : num 0.25</span>
<span class="co">#&gt;   ..$ perm_h     : num 200</span>
<span class="co">#&gt;   ..$ h_a        : num 100</span>
<span class="co">#&gt;   ..$ r_a        : num 43487</span>
<span class="co">#&gt;   ..$ r_R        : num 9200</span>
<span class="co">#&gt;   ..$ tetha      : num 140</span>
<span class="co">#&gt;   ..$ mu_water   : num 0.55</span>
<span class="co">#&gt;   ..$ c_water    : num 3e-06</span>
<span class="co">#&gt;   ..$ c_rock     : num 4e-06</span>
<span class="co">#&gt;   ..$ pressure   : num [1:11] 2740 2500 2290 2109 1949 ...</span>
<span class="co">#&gt;   ..$ mult_len   : num [1:2] 1 1</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "pss_rad_edge" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:11] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ sorw       : num 0.2</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ p_est      : num [1:11] 2740 2523 2330 2156 1986 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "water_drive_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance-3" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance-3" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb26"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;    P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1      2740      0.00000      0.00000 0.0000000000     0.000000     0.00000000</span>
<span class="co">#&gt; 2      2500      0.02684      0.00005 0.0007202593     0.000960     0.02897420</span>
<span class="co">#&gt; 3      2290      0.05735      0.00014 0.0013509117     0.001800     0.06135183</span>
<span class="co">#&gt; 4      2109      0.09231      0.00024 0.0018947929     0.002524     0.09792169</span>
<span class="co">#&gt; 5      1949      0.14112      0.00035 0.0023758178     0.003164     0.14815489</span>
<span class="co">#&gt; 6      1818      0.18812      0.00046 0.0027698289     0.003688     0.19632022</span>
<span class="co">#&gt; 7      1702      0.23800      0.00057 0.0031188535     0.004152     0.24723217</span>
<span class="co">#&gt; 8      1608      0.28620      0.00067 0.0034017729     0.004528     0.29626845</span>
<span class="co">#&gt; 9      1535      0.32990      0.00077 0.0036215420     0.004820     0.34061792</span>
<span class="co">#&gt; 10     1480      0.36304      0.00083 0.0037871532     0.005040     0.37424727</span>
<span class="co">#&gt; 11     1440      0.38952      0.00089 0.0039076149     0.005200     0.40108316</span>
<span class="co">#&gt;    Egwf (bbl/SCF)  Et (bbl)   F (bbl)       We Igd       Isd      Inwd</span>
<span class="co">#&gt; 1    0.000000e+00         0         0        0  NA        NA        NA</span>
<span class="co">#&gt; 2    5.141368e-05  13033980  12124483  3994030   0 0.6424806 0.3064321</span>
<span class="co">#&gt; 3    1.426508e-04  32685981  30761400 13544211   0 0.5474273 0.4143737</span>
<span class="co">#&gt; 4    2.437171e-04  55531705  52825922 24980137   0 0.5186356 0.4498356</span>
<span class="co">#&gt; 5    3.546599e-04  82781560  79797973 36557234   0 0.5318750 0.4416108</span>
<span class="co">#&gt; 6    4.654318e-04 108627009 105964372 47375101   0 0.5403209 0.4361264</span>
<span class="co">#&gt; 7    5.761153e-04 134205317 132292090 57068881   0 0.5533015 0.4252356</span>
<span class="co">#&gt; 8    6.766693e-04 158002511 157079858 65566756   0 0.5651454 0.4149729</span>
<span class="co">#&gt; 9    7.770995e-04 179004602 179177346 72731810   0 0.5750064 0.4063125</span>
<span class="co">#&gt; 10   8.374236e-04 195325095 196654410 78559947   0 0.5798972 0.4022010</span>
<span class="co">#&gt; 11   8.976594e-04 208286850 210742780 83148903   0 0.5834753 0.3992038</span>
<span class="co">#&gt;          Ifwd Iawd Itot     RF_oil     RF_gas       SOo        SGo  SWo</span>
<span class="co">#&gt; 1          NA   NA   NA 0.00000000 0.00000000 0.7500000 0.00000000 0.25</span>
<span class="co">#&gt; 2  0.05108730    0    1 0.02715098 0.03174576 0.7219261 0.02807391 0.25</span>
<span class="co">#&gt; 3  0.03819894    0    1 0.06273219 0.08155185 0.6991197 0.05088028 0.25</span>
<span class="co">#&gt; 4  0.03152879    0    1 0.09821502 0.13901202 0.6810118 0.06898825 0.25</span>
<span class="co">#&gt; 5  0.02651419    0    1 0.13529285 0.20293927 0.6641284 0.08587157 0.25</span>
<span class="co">#&gt; 6  0.02355277    0    1 0.16474327 0.25978747 0.6506495 0.09935045 0.25</span>
<span class="co">#&gt; 7  0.02146291    0    1 0.18995153 0.31122828 0.6399722 0.11002776 0.25</span>
<span class="co">#&gt; 8  0.01988168    0    1 0.21081438 0.35514115 0.6314801 0.11851989 0.25</span>
<span class="co">#&gt; 9  0.01868104    0    1 0.22651218 0.39029791 0.6249439 0.12505610 0.25</span>
<span class="co">#&gt; 10 0.01790178    0    1 0.23729531 0.41800481 0.6219729 0.12802707 0.25</span>
<span class="co">#&gt; 11 0.01732086    0    1 0.24528095 0.43773215 0.6199618 0.13003822 0.25</span>
<span class="co">#&gt;          SOT        SGT       SWT qo (STB/day) qg (SCF/day) qw (STB/day)</span>
<span class="co">#&gt; 1  0.7500000 0.00000000 0.2500000        0.000            0            0</span>
<span class="co">#&gt; 2  0.7154368 0.02772486 0.2568383    21589.041     16407671            0</span>
<span class="co">#&gt; 3  0.6780754 0.04873502 0.2731896    28876.712     26235890            0</span>
<span class="co">#&gt; 4  0.6436070 0.06362353 0.2927695    29397.260     30830411            0</span>
<span class="co">#&gt; 5  0.6113097 0.07609920 0.3125911    31616.438     35218493            0</span>
<span class="co">#&gt; 6  0.5841887 0.08469846 0.3311129    25890.411     32111644            0</span>
<span class="co">#&gt; 7  0.5618092 0.09048084 0.3477100    22684.932     29654247            0</span>
<span class="co">#&gt; 8  0.5434115 0.09432900 0.3622595    19095.890     25711644            0</span>
<span class="co">#&gt; 9  0.5287311 0.09674178 0.3745271    14657.534     20895205            0</span>
<span class="co">#&gt; 10 0.5187770 0.09671730 0.3845057    10410.959     16765753            0</span>
<span class="co">#&gt; 11 0.5112584 0.09637897 0.3923627     7917.808     12247945            0</span>
<span class="co">#&gt;           fg fw GOR (SCF/STB)     krg/kro</span>
<span class="co">#&gt; 1  0.0000000  0      650.0000 0.000000000</span>
<span class="co">#&gt; 2  0.1070036  0      760.0000 0.004793013</span>
<span class="co">#&gt; 3  0.2402547  0      908.5484 0.011534374</span>
<span class="co">#&gt; 4  0.3482651  0     1048.7512 0.019077468</span>
<span class="co">#&gt; 5  0.4164981  0     1113.9298 0.025013683</span>
<span class="co">#&gt; 6  0.4961705  0     1240.2910 0.034063684</span>
<span class="co">#&gt; 7  0.5453001  0     1307.2222 0.041231324</span>
<span class="co">#&gt; 8  0.5811543  0     1346.4491 0.047164522</span>
<span class="co">#&gt; 9  0.6195034  0     1425.5607 0.055386040</span>
<span class="co">#&gt; 10 0.6686145  0     1610.3947 0.068380399</span>
<span class="co">#&gt; 11 0.6609354  0     1546.8858 0.067646573</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-12-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-12-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Isd"</span>, <span class="st">"Inwd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-12-4.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-5-water-drive-saturated-black-oil-reservoir-pletcher2002a" class="section level2">
<h2 class="hasAnchor">
<a href="#example-5-water-drive-saturated-black-oil-reservoir-pletcher2002a" class="anchor"></a><code>Example 5: Water-Drive Saturated Black Oil Reservoir</code> <font size="2"> <span class="citation">(Pletcher, 2002)</span> </font>
</h2>
<div id="part-i-history-match-4" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match-4" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">p_pvt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2855</span>,    <span class="fl">2779</span>,   <span class="fl">2627</span>,   <span class="fl">2457</span>,   <span class="fl">2402</span>,   <span class="fl">2223</span>,   <span class="fl">2080</span>,   <span class="fl">1833</span>,   <span class="fl">1665</span>,   <span class="fl">1460</span>)  <span class="co"># psia</span>

<span class="no">Bo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.2665</span>, <span class="fl">1.2677</span>, <span class="fl">1.2681</span>, <span class="fl">1.2554</span>, <span class="fl">1.2512</span>, <span class="fl">1.2383</span>, <span class="fl">1.2278</span>, <span class="fl">1.2074</span>, <span class="fl">1.1949</span>,
        <span class="fl">1.1802</span>)  <span class="co"># RB/STB</span>

<span class="no">Rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.501</span>, <span class="fl">0.501</span>,   <span class="fl">0.4973</span>, <span class="fl">0.4671</span>, <span class="fl">0.4574</span>, <span class="fl">0.4269</span>, <span class="fl">0.4024</span>, <span class="fl">0.3579</span>, <span class="fl">0.3277</span>,
        <span class="fl">0.2908</span>) * <span class="fl">1000</span>  <span class="co">#SCF/STB</span>

<span class="no">Bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.9201</span>, <span class="fl">0.9637</span>, <span class="fl">1.0502</span>, <span class="fl">1.0977</span>, <span class="fl">1.1146</span>, <span class="fl">1.201</span>, <span class="fl">1.2825</span>, <span class="fl">1.4584</span>, <span class="fl">1.6112</span>,
        <span class="fl">1.8526</span>) / <span class="fl">1000</span>  <span class="co"># RB/SCF</span>

<span class="no">Bw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.0222</span>, <span class="fl">1.0224</span>, <span class="fl">1.0228</span>, <span class="fl">1.0232</span>, <span class="fl">1.0233</span>, <span class="fl">1.0237</span>, <span class="fl">1.024</span>,  <span class="fl">1.0246</span>, <span class="fl">1.025</span>,
        <span class="fl">1.0254</span>)  <span class="co"># RB/STB</span>

<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.55</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.02</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p_pvt</span>, <span class="kw">Bo</span> <span class="kw">=</span> <span class="no">Bo</span>, <span class="kw">Rs</span> <span class="kw">=</span> <span class="no">Rs</span>, <span class="kw">Rv</span> <span class="kw">=</span> <span class="no">Rv</span>, <span class="kw">Bg</span> <span class="kw">=</span> <span class="no">Bg</span>,
                               <span class="kw">Bw</span> <span class="kw">=</span> <span class="no">Bw</span>, <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">muw</span> <span class="kw">=</span> <span class="no">muw</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2855</span>,    <span class="fl">2779</span>,   <span class="fl">2627</span>,   <span class="fl">2457</span>,   <span class="fl">2402</span>,   <span class="fl">2223</span>,   <span class="fl">2080</span>,   <span class="fl">1833</span>,   <span class="fl">1665</span>,   <span class="fl">1460</span>)  <span class="co"># psia</span>

<span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,  <span class="fl">192821</span>, <span class="fl">633942</span>, <span class="fl">1314880</span>,    <span class="fl">1524400</span>,    <span class="fl">2152960</span>,    <span class="fl">2572000</span>,    <span class="fl">3200560</span>,
        <span class="fl">3584680</span>,    <span class="fl">4003720</span>)  <span class="co"># STB</span>

<span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,  <span class="fl">501</span>,    <span class="fl">492.2595442</span>,    <span class="fl">540.4827817</span>,    <span class="fl">558.2091315</span>,    <span class="fl">629.7005054</span>,
        <span class="fl">708.8841369</span>,    <span class="fl">853.8693229</span>,    <span class="fl">947.8502963</span>,    <span class="fl">1053.050663</span>)  <span class="co"># SCF/STB</span>

<span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                           <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"We"</span>,
                                           <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="st">"pot"</span>, <span class="kw">N</span> <span class="kw">=</span> <span class="fl">20e6</span>,
                                           <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.28</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.208</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>,
                                           <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>, <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>,
                                           <span class="kw">We</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">2648</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>,
                                           <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">26e-6</span>, <span class="kw">phi_a</span> <span class="kw">=</span> <span class="fl">0.28</span>, <span class="kw">h_a</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">r_a</span> <span class="kw">=</span> <span class="fl">1000</span>,
                                           <span class="kw">r_R</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">tetha</span> <span class="kw">=</span> <span class="fl">360</span>, <span class="kw">cw_a</span> <span class="kw">=</span> <span class="fl">2.28e-6</span>,
                                           <span class="kw">cf_a</span> <span class="kw">=</span> <span class="fl">26e-6</span>, <span class="kw">mult_len</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>,
                                           <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0.0</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">305</span>, <span class="fl">700</span>, <span class="fl">1285</span>, <span class="fl">1465</span>, <span class="fl">2005</span>, <span class="fl">2365</span>, <span class="fl">2905</span>, <span class="fl">3235</span>, <span class="fl">3595</span>), <span class="st">"day"</span>)

<span class="co"># a number of plots will be automatically generated for quality check</span>

<span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-13-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-13-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb31"><html><body><pre class="r">
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 2e+07</span>
<span class="co">#&gt;  $ m          : num 0</span>
<span class="co">#&gt;  $ phi        : num 0.28</span>
<span class="co">#&gt;  $ swi        : num 0.208</span>
<span class="co">#&gt;  $ pb         : num 2648</span>
<span class="co">#&gt;  $ p          : num [1:10] 2855 2779 2627 2457 2402 ...</span>
<span class="co">#&gt;  $ cf         : num [1:10] 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 10 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:10] 2855 2779 2627 2457 2402 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:10] 1.27 1.27 1.27 1.26 1.25 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:10] 501 501 497 467 457 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:10] 0 0 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Bg : num [1:10] 0.00092 0.000964 0.00105 0.001098 0.001115 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:10] 1.02 1.02 1.02 1.02 1.02 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:10] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="co">#&gt;   ..$ mug: num [1:10] 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02</span>
<span class="co">#&gt;   ..$ muw: num [1:10] 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55</span>
<span class="co">#&gt;  $ prod       :'data.frame': 10 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:10] 0 192821 633942 1314880 1524400 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:10] 501 501 492 540 558 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:10] 0 0 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ inj        :'data.frame': 10 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:10] 0 0 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Wi: num [1:10] 0 0 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ We         : NULL</span>
<span class="co">#&gt;  $ aquifer    :List of 12</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ model      : chr "pot"</span>
<span class="co">#&gt;   ..$ phi        : num 0.28</span>
<span class="co">#&gt;   ..$ h_a        : num 200</span>
<span class="co">#&gt;   ..$ r_a        : num 1625</span>
<span class="co">#&gt;   ..$ r_R        : num 300</span>
<span class="co">#&gt;   ..$ tetha      : num 360</span>
<span class="co">#&gt;   ..$ c_water    : num 2.28e-06</span>
<span class="co">#&gt;   ..$ c_rock     : num 2.6e-05</span>
<span class="co">#&gt;   ..$ pressure   : num [1:10] 2855 2779 2627 2457 2402 ...</span>
<span class="co">#&gt;   ..$ mult_len   : num 1</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "pot" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:10] 1 1 1 1 1 1 1 1 1 1</span>
<span class="co">#&gt;  $ sorw       : num 0</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ p_est      : num [1:10] 2855 2793 2639 2458 2400 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "water_drive_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance-4" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance-4" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb32"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;    P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1      2855   0.00000000    0.0000000       0.0000     0.000000    0.000000000</span>
<span class="co">#&gt; 2      2779   0.00120000    0.0000436       0.0002     0.001976    0.004424932</span>
<span class="co">#&gt; 3      2627   0.00548574    0.0001301       0.0006     0.005928    0.015160536</span>
<span class="co">#&gt; 4      2457   0.02611203    0.0001776       0.0010     0.010348    0.042985076</span>
<span class="co">#&gt; 5      2402   0.03329656    0.0001945       0.0011     0.011778    0.052488882</span>
<span class="co">#&gt; 6      2223   0.06079410    0.0002809       0.0015     0.016432    0.087558865</span>
<span class="co">#&gt; 7      2080   0.08775450    0.0003624       0.0018     0.020150    0.120562397</span>
<span class="co">#&gt; 8      1833   0.14959704    0.0005383       0.0024     0.026572    0.192869697</span>
<span class="co">#&gt; 9      1665   0.20762096    0.0006911       0.0028     0.030940    0.258008713</span>
<span class="co">#&gt; 10     1460   0.30311652    0.0009325       0.0032     0.036270    0.362157719</span>
<span class="co">#&gt;    Egwf (bbl/SCF)   Et (bbl)    F (bbl)        We Igd        Isd      Inwd</span>
<span class="co">#&gt; 1    0.000000e+00        0.0        0.0       0.0  NA         NA        NA</span>
<span class="co">#&gt; 2    4.594288e-05   260239.2   244439.2  171740.6   0 0.09222284 0.6599335</span>
<span class="co">#&gt; 3    1.371286e-04   818432.4   800546.1  515221.7   0 0.13405481 0.6295226</span>
<span class="co">#&gt; 4    1.898581e-04  1759079.8  1756616.9  899378.2   0 0.29688284 0.5112777</span>
<span class="co">#&gt; 5    2.084430e-04  2073441.8  2078613.7 1023664.2   0 0.32117188 0.4937029</span>
<span class="co">#&gt; 6    3.003443e-04  3179335.7  3190392.6 1428158.4   0 0.38243272 0.4492003</span>
<span class="co">#&gt; 7    3.862346e-04  4162549.8  4168867.1 1751301.9   0 0.42163820 0.4207281</span>
<span class="co">#&gt; 8    5.697372e-04  6166852.6  6179390.5 2309458.7   0 0.48516496 0.3744955</span>
<span class="co">#&gt; 9    7.277062e-04  7849270.0  7865096.8 2689095.8   0 0.52901979 0.3425918</span>
<span class="co">#&gt; 10   9.753929e-04 10395497.7 10379025.8 3152343.3   0 0.58316885 0.3032412</span>
<span class="co">#&gt;         Ifwd Iawd Itot     RF_oil     RF_gas       SOo         SGo   SWo</span>
<span class="co">#&gt; 1         NA   NA   NA 0.00000000 0.00000000 0.7920000 0.000000000 0.208</span>
<span class="co">#&gt; 2  0.2478437    0    1 0.01026423 0.01026423 0.7920000 0.000000000 0.208</span>
<span class="co">#&gt; 3  0.2364226    0    1 0.03240530 0.03183995 0.7838077 0.008192323 0.208</span>
<span class="co">#&gt; 4  0.1918395    0    1 0.06583618 0.07102459 0.7604465 0.031553479 0.208</span>
<span class="co">#&gt; 5  0.1851253    0    1 0.07603035 0.08471225 0.7532358 0.038764163 0.208</span>
<span class="co">#&gt; 6  0.1683670    0    1 0.10727493 0.13483248 0.7322947 0.059705305 0.208</span>
<span class="co">#&gt; 7  0.1576337    0    1 0.12840513 0.18168534 0.7187544 0.073245562 0.208</span>
<span class="co">#&gt; 8  0.1403395    0    1 0.15970331 0.27218713 0.6978396 0.094160374 0.208</span>
<span class="co">#&gt; 9  0.1283884    0    1 0.17887333 0.33841345 0.6861394 0.105860648 0.208</span>
<span class="co">#&gt; 10 0.1135899    0    1 0.20050370 0.42143824 0.6741928 0.117807164 0.208</span>
<span class="co">#&gt;          SOT           SGT       SWT qo (STB/day) qg (SCF/day) qw (STB/day)</span>
<span class="co">#&gt; 1  0.7920000 -2.775558e-17 0.2080000        0.000          0.0            0</span>
<span class="co">#&gt; 2  0.7866301 -2.775558e-17 0.2133699      632.200     316732.2            0</span>
<span class="co">#&gt; 3  0.7678647  8.025688e-03 0.2241096     1116.762     545470.1            0</span>
<span class="co">#&gt; 4  0.7334458  3.043313e-02 0.2361211     1163.997     681377.8            0</span>
<span class="co">#&gt; 5  0.7227952  3.719758e-02 0.2400072     1164.000     779244.4            0</span>
<span class="co">#&gt; 6  0.6910064  5.633900e-02 0.2526546     1164.000     934788.9            0</span>
<span class="co">#&gt; 7  0.6690602  6.818141e-02 0.2627584     1164.000    1298694.4            0</span>
<span class="co">#&gt; 8  0.6342142  8.557532e-02 0.2802105     1164.000    1684463.0            0</span>
<span class="co">#&gt; 9  0.6132971  9.462222e-02 0.2920807     1164.000    2014787.9            0</span>
<span class="co">#&gt; 10 0.5902889  1.031459e-01 0.3065652     1164.000    2273277.8            0</span>
<span class="co">#&gt;           fg fw GOR (SCF/STB)     krg/kro</span>
<span class="co">#&gt; 1        NaN  0      501.0000 0.000000000</span>
<span class="co">#&gt; 2  0.0000000  0      501.0000 0.000000000</span>
<span class="co">#&gt; 3  0.0000000  0      488.4390 0.000000000</span>
<span class="co">#&gt; 4  0.1134783  0      585.3778 0.004136803</span>
<span class="co">#&gt; 5  0.1955796  0      669.4540 0.007556118</span>
<span class="co">#&gt; 6  0.3039087  0      803.0832 0.014594075</span>
<span class="co">#&gt; 7  0.4671160  0     1115.7169 0.029803841</span>
<span class="co">#&gt; 8  0.6056177  0     1447.1331 0.052626722</span>
<span class="co">#&gt; 9  0.6905361  0     1730.9174 0.075683786</span>
<span class="co">#&gt; 10 0.7563766  0     1952.9878 0.104367703</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-14-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb34"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-14-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Isd"</span>, <span class="st">"Inwd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-14-4.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-6-combination-drive-black-oil-reservoir" class="section level2">
<h2 class="hasAnchor">
<a href="#example-6-combination-drive-black-oil-reservoir" class="anchor"></a><code>Example 6: Combination-Drive Black Oil Reservoir</code>
</h2>
<div id="part-i-history-match-5" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-history-match-5" class="anchor"></a><code>Part I: History Match</code>
</h3>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">p_pvt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2627</span>, <span class="fl">2457</span>, <span class="fl">2402</span>, <span class="fl">2223</span>, <span class="fl">2080</span>, <span class="fl">1833</span>, <span class="fl">1665</span>, <span class="fl">1460</span>, <span class="fl">1400</span>)

<span class="no">Bo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.2681</span>, <span class="fl">1.2554</span>, <span class="fl">1.2512</span>, <span class="fl">1.2383</span>, <span class="fl">1.2278</span>, <span class="fl">1.2074</span>, <span class="fl">1.1949</span>, <span class="fl">1.1802</span>, <span class="fl">1.17</span>)

<span class="no">Rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.501</span>, <span class="fl">0.4973</span>, <span class="fl">0.4671</span>, <span class="fl">0.4574</span>, <span class="fl">0.4269</span>, <span class="fl">0.4024</span>, <span class="fl">0.3579</span>, <span class="fl">0.3277</span>, <span class="fl">0.2908</span>) * <span class="fl">1e3</span>

<span class="no">Bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.0502</span>, <span class="fl">1.0977</span>, <span class="fl">1.1146</span>, <span class="fl">1.2010</span>, <span class="fl">1.2825</span>, <span class="fl">1.4584</span>, <span class="fl">1.6112</span>, <span class="fl">1.8526</span>, <span class="fl">2.1</span>) / <span class="fl">1e3</span>

<span class="no">Bw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.0228</span>, <span class="fl">1.0232</span>, <span class="fl">1.0233</span>, <span class="fl">1.0237</span>, <span class="fl">1.0240</span>, <span class="fl">1.0246</span>, <span class="fl">1.0250</span>, <span class="fl">1.0254</span>, <span class="fl">1.0258</span>)

<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">muw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.55</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.02</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p_pvt</span>, <span class="kw">Bo</span> <span class="kw">=</span> <span class="no">Bo</span>, <span class="kw">Rs</span> <span class="kw">=</span> <span class="no">Rs</span>, <span class="kw">Rv</span> <span class="kw">=</span> <span class="no">Rv</span>, <span class="kw">Bg</span> <span class="kw">=</span> <span class="no">Bg</span>,
                               <span class="kw">Bw</span> <span class="kw">=</span> <span class="no">Bw</span>, <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">muw</span> <span class="kw">=</span> <span class="no">muw</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2627</span>, <span class="fl">2457</span>, <span class="fl">2402</span>, <span class="fl">2223</span>, <span class="fl">2080</span>, <span class="fl">1833</span>, <span class="fl">1665</span>, <span class="fl">1460</span>)

<span class="no">We</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Np</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">192821</span>, <span class="fl">633942</span>, <span class="fl">1314880</span>, <span class="fl">1524400</span>, <span class="fl">2152960</span>, <span class="fl">2572000</span>, <span class="fl">3200560</span>)

<span class="no">Rp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">490.1593</span>, <span class="fl">492.2595</span>, <span class="fl">540.4828</span>, <span class="fl">558.2091</span>, <span class="fl">629.7005</span>, <span class="fl">708.8841</span>, <span class="fl">853.8693</span>)

<span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="no">Wp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">26</span>, <span class="fl">60</span>, <span class="fl">822</span>)

<span class="no">Wi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>)

<span class="no">mbal_optim_oil_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_param_oil.html">mbal_optim_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                           <span class="kw">unknown_param</span> <span class="kw">=</span> <span class="st">"We"</span>,
                                           <span class="kw">aquifer_model</span> <span class="kw">=</span> <span class="st">"pot"</span>, <span class="kw">N</span> <span class="kw">=</span> <span class="fl">198e5</span>,
                                           <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.28</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">Np</span> <span class="kw">=</span> <span class="no">Np</span>, <span class="kw">Rp</span> <span class="kw">=</span> <span class="no">Rp</span>,
                                           <span class="kw">Wp</span> <span class="kw">=</span> <span class="no">Wp</span>, <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi</span>, <span class="kw">Wi</span> <span class="kw">=</span> <span class="no">Wi</span>, <span class="kw">We</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">2627</span>,
                                           <span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>, <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">26e-6</span>,
                                           <span class="kw">phi_a</span> <span class="kw">=</span> <span class="fl">0.28</span>, <span class="kw">perm_h_a</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">h_a</span> <span class="kw">=</span> <span class="fl">100</span>,
                                           <span class="kw">r_a</span> <span class="kw">=</span> <span class="fl">2592.013</span>, <span class="kw">r_R</span> <span class="kw">=</span> <span class="fl">1269.619</span>, <span class="kw">tetha</span> <span class="kw">=</span> <span class="fl">360</span>,
                                           <span class="kw">muw_a</span> <span class="kw">=</span> <span class="fl">0.55</span>, <span class="kw">cw_a</span> <span class="kw">=</span> <span class="fl">2.28e-6</span>, <span class="kw">cf_a</span> <span class="kw">=</span> <span class="fl">26e-6</span>,
                                           <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf</span>, <span class="kw">sorw</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0</span>,
                                           <span class="kw">mult_len</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>))

<span class="no">time_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">305</span>, <span class="fl">700</span>, <span class="fl">1285</span>, <span class="fl">1465</span>, <span class="fl">2005</span>, <span class="fl">2365</span>, <span class="fl">2905</span>), <span class="st">"day"</span>)

<span class="co"># a number of plots will be automatically generated for quality check</span>

<span class="no">optim_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_optim_oil.html">mbal_optim_oil</a></span>(<span class="no">mbal_optim_oil_lst</span>, <span class="no">time_lst</span>)</pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-15-2.png" width="576" style="display: block; margin: auto;"><img src="BlackOil_files/figure-html/unnamed-chunk-15-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb37"><html><body><pre class="r">
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">optim_results</span>)
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ input_unit : chr "Field"</span>
<span class="co">#&gt;  $ output_unit: chr "Field"</span>
<span class="co">#&gt;  $ N          : num 19800000</span>
<span class="co">#&gt;  $ m          : num 0.05</span>
<span class="co">#&gt;  $ phi        : num 0.28</span>
<span class="co">#&gt;  $ swi        : num 0.25</span>
<span class="co">#&gt;  $ pb         : num 2627</span>
<span class="co">#&gt;  $ p          : num [1:8] 2627 2457 2402 2223 2080 ...</span>
<span class="co">#&gt;  $ cf         : num [1:8] 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05 2.6e-05</span>
<span class="co">#&gt;  $ pvt        :'data.frame': 9 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ p  : num [1:9] 2627 2457 2402 2223 2080 ...</span>
<span class="co">#&gt;   ..$ Bo : num [1:9] 1.27 1.26 1.25 1.24 1.23 ...</span>
<span class="co">#&gt;   ..$ Rs : num [1:9] 501 497 467 457 427 ...</span>
<span class="co">#&gt;   ..$ Rv : num [1:9] 0 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Bg : num [1:9] 0.00105 0.0011 0.00111 0.0012 0.00128 ...</span>
<span class="co">#&gt;   ..$ Bw : num [1:9] 1.02 1.02 1.02 1.02 1.02 ...</span>
<span class="co">#&gt;   ..$ muo: num [1:9] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span>
<span class="co">#&gt;   ..$ mug: num [1:9] 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02</span>
<span class="co">#&gt;   ..$ muw: num [1:9] 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55 0.55</span>
<span class="co">#&gt;  $ prod       :'data.frame': 8 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ Np: num [1:8] 0 192821 633942 1314880 1524400 ...</span>
<span class="co">#&gt;   ..$ Rp: num [1:8] 501 490 492 540 558 ...</span>
<span class="co">#&gt;   ..$ Wp: num [1:8] 0 0 0 4 7 26 60 822</span>
<span class="co">#&gt;  $ inj        :'data.frame': 8 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ Gi: num [1:8] 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;   ..$ Wi: num [1:8] 0 0 0 0 0 0 0 0</span>
<span class="co">#&gt;  $ We         : NULL</span>
<span class="co">#&gt;  $ aquifer    :List of 12</span>
<span class="co">#&gt;   ..$ input_unit : chr "Field"</span>
<span class="co">#&gt;   ..$ output_unit: chr "Field"</span>
<span class="co">#&gt;   ..$ model      : chr "pot"</span>
<span class="co">#&gt;   ..$ phi        : num 0.28</span>
<span class="co">#&gt;   ..$ h_a        : num 100</span>
<span class="co">#&gt;   ..$ r_a        : num 1532</span>
<span class="co">#&gt;   ..$ r_R        : num 1270</span>
<span class="co">#&gt;   ..$ tetha      : num 360</span>
<span class="co">#&gt;   ..$ c_water    : num 2.28e-06</span>
<span class="co">#&gt;   ..$ c_rock     : num 2.6e-05</span>
<span class="co">#&gt;   ..$ pressure   : num [1:8] 2627 2457 2402 2223 2080 ...</span>
<span class="co">#&gt;   ..$ mult_len   : num 1</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "pot" "aquifer"</span>
<span class="co">#&gt;  $ wf         : num [1:8] 1 0 1 1 1 1 1 1</span>
<span class="co">#&gt;  $ sorw       : num 0.2</span>
<span class="co">#&gt;  $ sorg       : num 0</span>
<span class="co">#&gt;  $ p_est      : num [1:7] 2627 2379 2113 2058 1813 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "combination_oil" "mbal_oil"</span></pre></body></html></div>
</div>
<div id="part-ii-reservoir-performance-5" class="section level3">
<h3 class="hasAnchor">
<a href="#part-ii-reservoir-performance-5" class="anchor"></a><code>Part II: Reservoir Performance</code>
</h3>
<div class="sourceCode" id="cb38"><html><body><pre class="r">
<span class="no">mbal_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_perform_oil.html">mbal_perform_oil</a></span>(<span class="no">optim_results</span>, <span class="no">time_lst</span>)

<span class="no">mbal_results</span>
<span class="co">#&gt;   P (psia) Eo (bbl/STB) Eg (bbl/SCF) Ew (bbl/STB) Ef (bbl/bbl) Eowf (bbl/STB)</span>
<span class="co">#&gt; 1     2627   0.00000000    0.0000000       0.0000     0.000000     0.00000000</span>
<span class="co">#&gt; 2     2402   0.02088494    0.0000644       0.0005     0.005850     0.03098276</span>
<span class="co">#&gt; 3     2223   0.02256360    0.0001508       0.0009     0.010504     0.04069571</span>
<span class="co">#&gt; 4     2080   0.05473325    0.0002323       0.0012     0.014222     0.07927574</span>
<span class="co">#&gt; 5     1833   0.08309824    0.0004082       0.0018     0.020644     0.11874701</span>
<span class="co">#&gt; 6     1665   0.15736272    0.0005610       0.0022     0.025012     0.20056222</span>
<span class="co">#&gt; 7     1460   0.23315558    0.0008024       0.0026     0.030342     0.28553235</span>
<span class="co">#&gt;   Egwf (bbl/SCF)  Et (bbl)   F (bbl)        We        Igd       Isd       Inwd</span>
<span class="co">#&gt; 1   0.000000e+00       0.0       0.0      0.00         NA        NA         NA</span>
<span class="co">#&gt; 2   7.276269e-05  773590.4  810965.7  73150.61 0.09951567 0.5345488 0.09455987</span>
<span class="co">#&gt; 3   1.658164e-04 1135335.5 1759421.9 131345.99 0.15877927 0.3935042 0.11568914</span>
<span class="co">#&gt; 4   2.526253e-04 2049480.4 2128380.4 177837.27 0.13549464 0.5287771 0.08677188</span>
<span class="co">#&gt; 5   4.377232e-04 3132563.1 3313206.1 258140.38 0.15577217 0.5252393 0.08240549</span>
<span class="co">#&gt; 6   5.967764e-04 4997222.2 4527824.7 312759.51 0.13419950 0.6235028 0.06258667</span>
<span class="co">#&gt; 7   8.457768e-04 7043155.1 6897989.7 379407.85 0.13618847 0.6554563 0.05386902</span>
<span class="co">#&gt;        Ifwd          Iawd Itot     RF_oil     RF_gas       SOo       SGo  SWo</span>
<span class="co">#&gt; 1        NA            NA   NA 0.00000000 0.00000000 0.7500000 0.0000000 0.25</span>
<span class="co">#&gt; 2 0.2713757  0.000000e+00    1 0.03054168 0.02678148 0.5402420 0.2097580 0.25</span>
<span class="co">#&gt; 3 0.3320310 -3.606687e-06    1 0.04285250 0.04125775 0.5188036 0.2311964 0.25</span>
<span class="co">#&gt; 4 0.2489599 -3.497472e-06    1 0.07413610 0.07371811 0.5113559 0.2386441 0.25</span>
<span class="co">#&gt; 5 0.2365916 -8.504091e-06    1 0.10280770 0.11532068 0.4909592 0.2590408 0.25</span>
<span class="co">#&gt; 6 0.1797234 -1.230684e-05    1 0.14336751 0.18103957 0.4786985 0.2713015 0.25</span>
<span class="co">#&gt; 7 0.1546059 -1.196735e-04    1 0.16506636 0.25107155 0.4619185 0.2880815 0.25</span>
<span class="co">#&gt;         SOT        SGT       SWT qo (STB/day) qg (SCF/day) qw (STB/day)</span>
<span class="co">#&gt; 1 0.7142857 0.03571429 0.2500000       0.0000          0.0  0.000000000</span>
<span class="co">#&gt; 2 0.5116513 0.23626772 0.2520810     905.6314     445805.7  0.000000000</span>
<span class="co">#&gt; 3 0.4883854 0.25787816 0.2537364    1163.9966     681377.9  0.006837607</span>
<span class="co">#&gt; 4 0.4787555 0.26618554 0.2550589    1164.0000     779244.0  0.016666667</span>
<span class="co">#&gt; 5 0.4546085 0.28804863 0.2573428    1164.0000     934789.0  0.035185185</span>
<span class="co">#&gt; 6 0.4392188 0.30188550 0.2588957    1164.0000    1298694.2  0.094444444</span>
<span class="co">#&gt; 7 0.4179878 0.32124277 0.2607695    1164.0000    1684463.0  1.411111111</span>
<span class="co">#&gt;           fg           fw GOR (SCF/STB)      krg/kro</span>
<span class="co">#&gt; 1 0.00000000 0.000000e+00      501.0000 0.0000000000</span>
<span class="co">#&gt; 2 0.02192139 0.000000e+00      492.2595 0.0008965083</span>
<span class="co">#&gt; 3 0.11729462 4.286600e-06      585.3779 0.0049649180</span>
<span class="co">#&gt; 4 0.31190606 8.216950e-06      669.4536 0.0101343884</span>
<span class="co">#&gt; 5 0.35721705 1.648782e-05      803.0833 0.0193591691</span>
<span class="co">#&gt; 6 0.57082184 2.986917e-05     1115.7167 0.0408735202</span>
<span class="co">#&gt; 7 0.66091802 3.567742e-04     1447.1332 0.0702884894</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SOo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb39"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-16-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb40"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-16-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">mbal_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Igd"</span>,<span class="st">"Isd"</span>, <span class="st">"Inwd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-16-4.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-7-undersaturated-black-oil-reservoir-walsh1994a" class="section level2">
<h2 class="hasAnchor">
<a href="#example-7-undersaturated-black-oil-reservoir-walsh1994a" class="anchor"></a><code>Example 7: Undersaturated Black Oil Reservoir</code> <font size="2"> <span class="citation">(Walsh, Ansah, &amp; Raghavan, 1994)</span> </font>
</h2>
<div id="part-i-reservoir-forecast" class="section level3">
<h3 class="hasAnchor">
<a href="#part-i-reservoir-forecast" class="anchor"></a><code>Part I: Reservoir Forecast</code>
</h3>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rmbal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rrelperm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pracma</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">p_pvt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2000</span>,    <span class="fl">1800</span>,   <span class="fl">1700</span>,   <span class="fl">1640</span>,   <span class="fl">1600</span>,   <span class="fl">1400</span>,   <span class="fl">1200</span>,   <span class="fl">1000</span>,   <span class="fl">800</span>, <span class="fl">600</span>, <span class="fl">400</span>, <span class="fl">200</span>) <span class="co"># psia</span>

<span class="no">Bo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.467</span>, <span class="fl">1.472</span>, <span class="fl">1.475</span>, <span class="fl">1.463</span>, <span class="fl">1.453</span>, <span class="fl">1.408</span>, <span class="fl">1.359</span>, <span class="fl">1.322</span>, <span class="fl">1.278</span>, <span class="fl">1.237</span>,
        <span class="fl">1.194</span>, <span class="fl">1.141</span>) <span class="co"># RB/STB</span>

<span class="no">Rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">838.5</span>, <span class="fl">838.5</span>, <span class="fl">838.5</span>, <span class="fl">816.1</span>, <span class="fl">798.4</span>, <span class="fl">713.4</span>, <span class="fl">621</span>, <span class="fl">548</span>, <span class="fl">464</span>, <span class="fl">383.9</span>, <span class="fl">297.4</span>,
        <span class="fl">190.9</span>) <span class="co">#SCF/STB</span>

<span class="no">Bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.749</span>, <span class="fl">1.755</span>, <span class="fl">1.758</span>, <span class="fl">1.921</span>, <span class="fl">1.977</span>, <span class="fl">2.308</span>, <span class="fl">2.73</span>, <span class="fl">3.328</span>, <span class="fl">4.163</span>, <span class="fl">5.471</span>,
        <span class="fl">7.786</span>, <span class="fl">13.331</span>) / <span class="fl">1000</span> <span class="co"># RB/SCF</span>

<span class="no">Rv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1192.6</span>, <span class="fl">1192.6</span>, <span class="fl">1192.6</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>,   <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>) / <span class="fl">1e6</span> <span class="co"># STB/SCF</span>

<span class="no">cw</span> <span class="kw">&lt;-</span> <span class="fl">2e-6</span>

<span class="no">Bwi</span> <span class="kw">&lt;-</span> <span class="fl">1.0</span>

<span class="no">Bw</span> <span class="kw">&lt;-</span> <span class="no">Bwi</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">cw</span> * (<span class="no">p_pvt</span>[<span class="fl">1</span>] - <span class="no">p_pvt</span>))


<span class="no">muo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3201</span>,    <span class="fl">0.3114</span>, <span class="fl">0.3071</span>, <span class="fl">0.3123</span>, <span class="fl">0.316</span>, <span class="fl">0.34</span>,    <span class="fl">0.371</span>, <span class="fl">0.397</span>, <span class="fl">0.432</span>, <span class="fl">0.471</span>,
         <span class="fl">0.518</span>, <span class="fl">0.589</span>)  <span class="co"># cp</span>

<span class="no">muw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_pvt</span>))

<span class="no">mug</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3201</span>, <span class="fl">0.3114</span>, <span class="fl">0.3071</span>, <span class="fl">0.0157</span>, <span class="fl">0.0155</span>, <span class="fl">0.014</span>, <span class="fl">0.0138</span>, <span class="fl">0.0132</span>, <span class="fl">0.0126</span>, <span class="fl">0.0121</span>,
         <span class="fl">0.0116</span>,    <span class="fl">0.0108</span>) <span class="co"># cp</span>

<span class="no">pvt_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p_pvt</span>, <span class="kw">Bo</span> <span class="kw">=</span> <span class="no">Bo</span>, <span class="kw">Rs</span> <span class="kw">=</span> <span class="no">Rs</span>, <span class="kw">Rv</span> <span class="kw">=</span> <span class="no">Rv</span>, <span class="kw">Bg</span> <span class="kw">=</span> <span class="no">Bg</span>,
                               <span class="kw">Bw</span> <span class="kw">=</span> <span class="no">Bw</span>, <span class="kw">muo</span> <span class="kw">=</span> <span class="no">muo</span>, <span class="kw">mug</span> <span class="kw">=</span> <span class="no">mug</span>, <span class="kw">muw</span> <span class="kw">=</span> <span class="no">muw</span>)

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2000</span>,    <span class="fl">1800</span>,   <span class="fl">1700</span>,   <span class="fl">1640</span>,   <span class="fl">1600</span>,   <span class="fl">1400</span>,   <span class="fl">1200</span>,   <span class="fl">1000</span>,   <span class="fl">800</span>, <span class="fl">600</span>, <span class="fl">400</span>, <span class="fl">200</span>) <span class="co"># psia</span>

<span class="no">Gi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="no">wf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p</span>))

<span class="co"># generating a set of pseudo relative permeability curves using </span>
<span class="co"># laboratory 'Kr' values</span>

<span class="no">sg_lab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.152</span>, <span class="fl">0.248</span>, <span class="fl">0.352</span>, <span class="fl">0.448</span>, <span class="fl">0.552</span>, <span class="fl">0.65</span>)

<span class="no">krg_lab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.09</span>, <span class="fl">0.18</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">1</span>)

<span class="no">kro_lab</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.35</span>, <span class="fl">0.13</span>, <span class="fl">0.04</span>, <span class="fl">0.01</span>, <span class="fl">0</span>)

<span class="no">swcrit_lab</span> <span class="kw">&lt;-</span> <span class="fl">0.2</span>

<span class="no">sgcrit_lab</span> <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="no">sorgr_lab</span> <span class="kw">&lt;-</span> <span class="fl">0.15</span>

<span class="no">fun_kr</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">swcrit</span>, <span class="no">sgcrit</span>, <span class="no">sorg</span>, <span class="no">sg</span>, <span class="no">krg</span>, <span class="no">kro</span>) {

  <span class="no">kr_est</span> <span class="kw">&lt;-</span> <span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">sorg</span>, <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">sorg</span>,
                               <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="fl">1</span>,
                               <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">NG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">1</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">x</span>[<span class="fl">2</span>], <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>)

   <span class="no">krg_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">kr_est</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">kr_est</span>[,<span class="fl">3</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

   <span class="no">kro_est_sub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">kr_est</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">kr_est</span>[,<span class="fl">4</span>], <span class="kw">xout</span> <span class="kw">=</span> <span class="no">sg</span>, <span class="kw">rule</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">y</span>

   <span class="no">error</span> <span class="kw">&lt;-</span> (<span class="no">krg</span> - <span class="no">krg_est_sub</span>) ^ <span class="fl">2</span> + (<span class="no">kro</span> - <span class="no">kro_est_sub</span>) ^ <span class="fl">2</span>

   <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">error</span>)
}

<span class="no">par</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>)

<span class="no">opt_results</span> <span class="kw">&lt;-</span> <span class="kw pkg">minpack.lm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html">nls.lm</a></span>(<span class="kw">par</span> <span class="kw">=</span> <span class="no">par</span>, <span class="kw">fn</span> <span class="kw">=</span> <span class="no">fun_kr</span>, <span class="kw">swcrit</span> <span class="kw">=</span> <span class="no">swcrit_lab</span>,
                                  <span class="kw">sgcrit</span> <span class="kw">=</span> <span class="no">sgcrit_lab</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="no">sorgr_lab</span>, <span class="kw">sg</span> <span class="kw">=</span> <span class="no">sg_lab</span>,
                                  <span class="kw">krg</span> <span class="kw">=</span> <span class="no">krg_lab</span>, <span class="kw">kro</span> <span class="kw">=</span> <span class="no">kro_lab</span>,
                                  <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">10</span>))

<span class="no">sol</span> <span class="kw">&lt;-</span> <span class="no">opt_results</span>$<span class="no">par</span>

<span class="no">sol</span>
<span class="co">#&gt; [1] 3.157478 2.740570</span>

<span class="no">rel_perm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw pkg">Rrelperm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rrelperm/man/kr2p_gl.html">kr2p_gl</a></span>(<span class="kw">SWCON</span> <span class="kw">=</span> <span class="no">swcrit_lab</span>, <span class="kw">SOIRG</span> <span class="kw">=</span> <span class="no">sorgr_lab</span>,
                                            <span class="kw">SORG</span> <span class="kw">=</span> <span class="no">sorgr_lab</span>, <span class="kw">SGCON</span> <span class="kw">=</span> <span class="no">sgcrit_lab</span>,
                                            <span class="kw">SGCRIT</span> <span class="kw">=</span> <span class="no">sgcrit_lab</span>, <span class="kw">KRGCL</span> <span class="kw">=</span> <span class="fl">1</span>,
                                            <span class="kw">KROGCG</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">NG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">1</span>], <span class="kw">NOG</span> <span class="kw">=</span> <span class="no">sol</span>[<span class="fl">2</span>],
                                            <span class="kw">NP</span> <span class="kw">=</span> <span class="fl">101</span>))

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">rel_perm</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sg"</span>, <span class="st">"Sl"</span>, <span class="st">"Krg"</span>, <span class="st">"Krog"</span>)

<span class="no">p_forecast</span> <span class="kw">&lt;-</span> <span class="no">p</span>

<span class="no">Gi_forecast</span> <span class="kw">&lt;-</span> <span class="no">Gi</span>

<span class="no">wf_forecast</span> <span class="kw">&lt;-</span> <span class="no">wf</span>

<span class="no">time_lst_forecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_time.html">mbal_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">p_forecast</span>)), <span class="st">"year"</span>)


<span class="no">forecast_lst</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_param_oil.html">mbal_forecast_param_oil</a></span>(<span class="kw">input_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>, <span class="kw">output_unit</span> <span class="kw">=</span> <span class="st">"Field"</span>,
                                        <span class="kw">N</span> <span class="kw">=</span> <span class="fl">1e6</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="fl">0.0</span>, <span class="kw">phi</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">swi</span> <span class="kw">=</span> <span class="fl">0.2</span>,
                                        <span class="kw">Gi</span> <span class="kw">=</span> <span class="no">Gi_forecast</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">1688</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="no">p_forecast</span>, <span class="kw">pvt</span> <span class="kw">=</span> <span class="no">pvt_table</span>,
                                        <span class="kw">cf</span> <span class="kw">=</span> <span class="fl">2e-6</span>, <span class="kw">wf</span> <span class="kw">=</span> <span class="no">wf_forecast</span>, <span class="kw">sorg</span> <span class="kw">=</span> <span class="fl">0.15</span>, <span class="kw">rel_perm</span> <span class="kw">=</span> <span class="no">rel_perm</span>)

<span class="no">forecast_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbal_forecast_oil.html">mbal_forecast_oil</a></span>(<span class="no">forecast_lst</span>, <span class="no">time_lst_forecast</span>)

<span class="no">forecast_results</span>
<span class="co">#&gt;    P (psia)       SOo        SGo SWo       SOT           SGT SWT GOR (SCF/STB)</span>
<span class="co">#&gt; 1      2000 0.8000000 0.00000000 0.2 0.8000000 -5.551115e-17 0.2      838.5000</span>
<span class="co">#&gt; 2      1800 0.8000000 0.00000000 0.2 0.8000000 -5.551115e-17 0.2      838.5000</span>
<span class="co">#&gt; 3      1700 0.8000000 0.00000000 0.2 0.8000000 -5.551115e-17 0.2      838.5000</span>
<span class="co">#&gt; 4      1640 0.7760603 0.02393968 0.2 0.7760603  2.393968e-02 0.2      816.1000</span>
<span class="co">#&gt; 5      1600 0.7568933 0.04310670 0.2 0.7568933  4.310670e-02 0.2      798.4000</span>
<span class="co">#&gt; 6      1400 0.6567060 0.14329396 0.2 0.6567060  1.432940e-01 0.2      779.9858</span>
<span class="co">#&gt; 7      1200 0.5712189 0.22878111 0.2 0.5712189  2.287811e-01 0.2     1393.2373</span>
<span class="co">#&gt; 8      1000 0.5253609 0.27463906 0.2 0.5253609  2.746391e-01 0.2     2492.8351</span>
<span class="co">#&gt; 9       800 0.4892171 0.31078287 0.2 0.4892171  3.107829e-01 0.2     4082.2189</span>
<span class="co">#&gt; 10      600 0.4615355 0.33846451 0.2 0.4615355  3.384645e-01 0.2     5637.4153</span>
<span class="co">#&gt; 11      400 0.4361405 0.36385948 0.2 0.4361405  3.638595e-01 0.2     7032.5091</span>
<span class="co">#&gt; 12      200 0.4081428 0.39185717 0.2 0.4081428  3.918572e-01 0.2     8162.1692</span>
<span class="co">#&gt;         RF_oil      RF_gas Liq_volume Igd       Isd Inwd        Ifwd Iawd Itot</span>
<span class="co">#&gt; 1  0.000000000 0.000000000  1.0000000  NA        NA   NA          NA   NA   NA</span>
<span class="co">#&gt; 2  0.003994721 0.003994721  1.0000000   0 0.8503070    0 0.149693029    0    1</span>
<span class="co">#&gt; 3  0.006318892 0.006318892  1.0000000   0 0.8583354    0 0.141664611    0    1</span>
<span class="co">#&gt; 4  0.027267733 0.026987916  0.9714233   0 0.9609887    0 0.039011263    0    1</span>
<span class="co">#&gt; 5  0.044759320 0.043827610  0.9482533   0 0.9737390    0 0.026261005    0    1</span>
<span class="co">#&gt; 6  0.144719675 0.137909903  0.8298311   0 0.9886352    0 0.011364829    0    1</span>
<span class="co">#&gt; 7  0.229232788 0.247430386  0.6959327   0 0.9928034    0 0.007196600    0    1</span>
<span class="co">#&gt; 8  0.271270328 0.344842981  0.5775993   0 0.9946722    0 0.005327778    0    1</span>
<span class="co">#&gt; 9  0.298042320 0.449808570  0.4504689   0 0.9961593    0 0.003840732    0    1</span>
<span class="co">#&gt; 10 0.315811886 0.552798243  0.3321593   0 0.9972770    0 0.002722969    0    1</span>
<span class="co">#&gt; 11 0.330173640 0.661302918  0.2208247   0 0.9982155    0 0.001784493    0    1</span>
<span class="co">#&gt; 12 0.344056159 0.787087298  0.1167364   0 0.9990470    0 0.000952989    0    1</span>

<span class="no">reservoir_performance_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>)

<span class="no">reservoir_performance_table</span>$<span class="no">`RF_oil`</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.4</span>,   <span class="fl">0.5</span>, <span class="fl">2.7</span>,   <span class="fl">4.4</span>, <span class="fl">11.3</span>, <span class="fl">16.1</span>,
                                          <span class="fl">19.3</span>, <span class="fl">22.2</span>,   <span class="fl">24.3</span>,   <span class="fl">26.2</span>,   <span class="fl">27.9</span>) / <span class="fl">100</span>

<span class="no">reservoir_performance_table</span>$<span class="no">`Sg`</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2.9</span>, <span class="fl">5.3</span>, <span class="fl">14.8</span>, <span class="fl">22.3</span>, <span class="fl">27.3</span>, <span class="fl">32.2</span>,
                                      <span class="fl">36.2</span>, <span class="fl">39.9</span>,   <span class="fl">43.9</span>) * <span class="fl">0.8</span> / <span class="fl">100</span>

<span class="no">reservoir_performance_table</span>$<span class="no">`GOR`</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.84</span>,    <span class="fl">0.84</span>,   <span class="fl">0.84</span>,   <span class="fl">0.82</span>,   <span class="fl">0.8</span>,    <span class="fl">1.41</span>,   <span class="fl">2.17</span>,
                                       <span class="fl">2.7</span>, <span class="fl">3.52</span>,   <span class="fl">4.58</span>,   <span class="fl">5.56</span>,   <span class="fl">6.79</span>) * <span class="fl">1000</span> <span class="co"># SCF/STB</span>

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">SGo</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">reservoir_performance_table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`p`</span>, <span class="no">Sg</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Gas Saturation Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p1</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><html><body><pre class="r">

<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`GOR (SCF/STB)`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">reservoir_performance_table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`p`</span>, <span class="no">GOR</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"GOR Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p2</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-17-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r">

<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`RF_oil`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">reservoir_performance_table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`p`</span>, <span class="no">RF_oil</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Field"</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"Field"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Oil Recovery Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p3</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-17-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r">

<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">`Liq_volume`</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Forecast"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Data"</span>, <span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Forecast"</span> <span class="kw">=</span> <span class="st">"red"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"CCE Liquid Volume Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p4</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-17-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb46"><html><body><pre class="r">

<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="no">forecast_results</span>  <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Isd"</span>, <span class="st">"Ifwd"</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Drive Mechanism"</span>,
                      <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"Fraction"</span>, <span class="kw">values_drop_na</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">`P (psia)`</span>, <span class="no">Fraction</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">`Drive Mechanism`</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy Plot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="no">p5</span></pre></body></html></div>
<p><img src="BlackOil_files/figure-html/unnamed-chunk-17-5.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a><code>References</code>
</h2>
<div id="refs" class="references">
<div id="ref-Ahmed2004">
<p>Ahmed, T., &amp; McKinney, P. D. (2004). <em>Advanced Reservoir Engineering</em> (p. 424). Gulf Professional Publishing.</p>
</div>
<div id="ref-Dake1983">
<p>Dake, L. P. (1983). <em>Fundamentals of Reservoir Engineering</em> (p. 462). Elsevier Science.</p>
</div>
<div id="ref-Pletcher2002a">
<p>Pletcher, J. L. (2002). Improvements to Reservoir Material-Balance Methods. <em>SPE Reservoir Evaluation &amp; Engineering</em>, <em>5</em>(01), 49â€“59. <a href="https://doi.org/10.2118/75354-PA">https://doi.org/10.2118/75354-PA</a></p>
</div>
<div id="ref-Walsh1994a">
<p>Walsh, M. P., Ansah, J., &amp; Raghavan, R. (1994). New, generalized material balance as an equation of a straight line: Part 1- Applications to undersaturated, volumetric reservoirs. <em>Proceedings of the Permian Basin Oil &amp; Gas Recovery Conference</em>, 549â€“564. <a href="https://doi.org/10.2118/27684-MS">https://doi.org/10.2118/27684-MS</a></p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://susaenergy.com/">Farshad Tabasinejad</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
